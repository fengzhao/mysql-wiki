## 常用SQL


### 用户管理

在UNIX平台中安装PostgreSQL之后，PostgreSQL会在UNIX系统中创建一个名为`postgres`的系统用户。PostgreSQL的默认用户名和数据库也是`postgres`。

如果是包管理器安装，一般会自动创建这个用户，如果是源代码编译安装，一般也建议创建一个这样的用户。Linux中的postgresql进程通常是由操作系统的postgres用户来启动的。

如果你连接到一个数据库时，你可以选择以何种PostgreSQL用户名进行连接的； 如果你不选择，那么缺省就是你的当前操作系统的账号。

如果这样，那么总有一个与操作系统用户同名的PostgreSQL用户账号用于启动服务器， 并且通常这个用户都有创建数据库的权限。

如果你不想以该用户身份登录， 那么你也可以在任何地方声明一个-U选项以选择一个用于连接的PostgreSQL用户名。

**PostgreSQL安装后默认用户名和数据库也是“postgres”，默认没有密码。在安装PostgreSQL之后可以以默认用户登录，也可以创建新当用户名。**

在PostgreSQL 里没有区分用户和角色的概念，"CREATE USER" 为 "CREATE ROLE" 的别名

这两个命令几乎是完全相同的，唯一的区别是"CREATE USER" 命令创建的用户默认带有LOGIN属性，而"CREATE ROLE" 命令创建的用户默认不带LOGIN属性。

> CREATE USER is equivalent to CREATE ROLE except that CREATE USER assumes LOGIN by default, while CREATE ROLE does not


官方建议是这样的：

> 在管理员创建一个具体数据库后，应该为所有可以连接到该数据库的用户分别创建一个与用户名相同的模式，然后，将search_path设置为"$user"(即缺省模式为与用户名相同的模式)，这样，任何当某个用户连接上来后，会默认将查找或者定义的对象都定位到与之同名的模式中。这是一个好的设计架构。

不建议项目的表存放在public下：

    - 一是数据安全；
    - 二是表存放混乱；不利于后期维护等等


```SQL

```


### 数据库管理

??? note "数据库创建"
    CREATE DATABASE实际上是通过拷贝一个现有的数据库进行工作的。默认地它将拷贝名为template1的标准系统数据库。 
    
    所以该数据库是创建新数据库的"模板"。如果你给template1增加对象，这些对象将被拷贝到随后创建的用户数据库中。这样的行为允许节点对数据库中的标准套件进行修改。
    
    比如，如果你把过程语言PL/Perl安装到template1里， 那么你在创建用户数据库的时候它们就会自动可得，而不需要额外的动作。
    
    PostgreSQL默认有template0、template1两个模板，创建数据库时不指定模板，则默认模板为template1。用户也可以指定其他的自定义模板创建数据库。
    
      - 使用 template1 模板库建库时不可指定新的字符集和本地化collate属性
    
      - 使用 template0 模板库建库时可指定字符集和本地化collate属性




    ```sql
    -- 建库
    create database db_test  with owner fengzhao tablespace pg_default;

    CREATE DATABASE db_test
     WITH  
        OWNER = stxz                     --属主，默认是default，表示当前执行sql的用户
        TEMPLATE = template0             --模板库，默认是template1
        ENCODING = UTF8	                 --要在新数据库中使用的字符集编码。一般用utf8就够了
        LC_COLLATE = 'zh_CN.utf8'        --要在新数据库中使用的整理顺序 (LC_COLLATE)。这会影响应用于字符串的排序顺序。
        LC_CTYPE = 'zh_CN.utf8'          --要在新数据库中使用的字符分类 (LC_CTYPE)。这会影响字符的分类，例如小写、大写和数字。
        TABLESPACE = default             --表空间，默认是default
        ALLOW_CONNECTIONS = true         --是否允许连接到此数据库。如果为 false，则没有人可以连接到该数据库。默认值为 true，允许连接。
        CONNECTION LIMIT = -1            --连接数限制。-1（默认）表示没有限制。
        IS_TEMPLATE = 0                  --是否可为模板
    ;	

    -- 查看所有数据库
    select *  from pg_database;
		 
    -- 



    ```

</details>


```SQL

-----------------------------------------------------------------------------------------------------------------
-- 建库
-- CREATE DATABASE实际上是通过拷贝一个现有的数据库进行工作的。默认地它将拷贝名为template1的标准系统数据库。 
-- 所以该数据库是创建新数据库的"模板"。如果你给template1增加对象，这些对象将被拷贝到随后创建的用户数据库中。这样的行为允许节点对数据库中的标准套件进行修改。 
-- 比如，如果你把过程语言PL/Perl安装到template1里， 那么你在创建用户数据库的时候它们就会自动可得，而不需要额外的动作。

-- PostgreSQL默认有template0、template1两个模板，创建数据库时不指定模板，则默认模板为template1。用户也可以指定其他的自定义模板创建数据库。
-- 使用 template1 模板库建库时不可指定新的字符集和本地化collate属性
-- 使用 template0 模板库建库时可指定字符集和本地化collate属性

-- 建库指定owner，指定表空间，这时默认的模板就是template1
create database db_test  with owner fengzhao tablespace pg_default;




CREATE DATABASE db_test
 WITH  
    OWNER = stxz  
    TEMPLATE = template0 
    ENCODING = UTF8	
    LC_COLLATE = 'zh_CN.utf8'
    LC_CTYPE = 'zh_CN.utf8'
    TABLESPACE = default 
    ALLOW_CONNECTIONS = true 
    CONNECTION LIMIT = -1 
    IS_TEMPLATE = 0 
;			 
			 


grant connect on database db_test to fengzhao;



-- 建模式

create schema public;
comment on schema public is 'test';
alter schema public owner to fengzhao;






-----------------------------------------------------------------------------------------------------------------






select *  from pg_database;
select * from pg_user;
select * from pg_stat_activity;

```