## 数据类型概述


MySQL 支持以下几种类别的 [SQL](https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_sql) 数据类型：

- 数值类型、
- "日期和时间"类型
- 字符串（字符和字节）类型
- 空间类型
- [JSON](https://dev.mysql.com/doc/refman/8.0/en/json.html) 数据类型


数据类型的描述使用了以下约定：

- 对于整型（integer），`int(M)` 中M表示最大的**显示宽度**（display width）；
- 对于浮点型（floating-point）和定点型（fixed-point）类型，`M` 表示可被存储数字的总个数（the precision）；
- 对于字符串类型，`varchar(M)` 中M是字符串中的字符数量。另外，`M` 的最大允许值取决于具体的数据类型和字符编码。
- `D` 应用于浮点型和定点型，它表示小数点后可存在多少个数字（the scale）。可能的最大值为 30，但不应大于 `M`-2。
- `fsp` 应用于 TIME、DATETIME 和 TIMESTAMP 类型，它表示小数的精度（即毫秒、微秒），即小数点后数字的个数。`fsp` 的取值范围为 [0, 6]，其中 0 表示没有小数。若缺省（即不传递该参数），默认精度为 0（与 SQL 标准的默认值 6 不同，主要为了兼容 MySQL 旧版本）。
- 方括号（[]）表示类型定义的可选部分。


## 数值类型

MySQL 支持 SQL 标准中所有数值数据类型。

其中包括 **精确数值类型**（INTEGER、SMALLINT、DECIMAL 和 NUMERIC），也包括 **近似数值类型**（FLOAT、REAL 和 DOUBLE PRECISION）。

**关键字 INT 是 INTEGER 的代名词，关键字 DEC 和 FIXED 是 DECIMAL 的代名词。**

MySQL 将 DOUBLE 视为 DOUBLE PRECISION 的代名词（一种非标准扩展）。

除非启用 SQL 的 [REAL_AS_FLOAT](https://dev.mysql.com/doc/refman/8.0/en/sql-mode.html#sqlmode_real_as_float) 模式，否则 MySQL 也把 REAL 视为 DOUBLE PRECISION 的代名词（一种非标准变体）。



### 精确整型

MySQL 支持 SQL 标准的整型类型：INTEGER（或 INT）和 SMALLINT。**不能存小数位。**

作为标准SQL的扩展，MySQL 也支持这些整型类型：TINYINT、MEDIUMINT 和 BIGINT。以下表格展示了每种整型类型所需的存储空间和取值范围。



| 类型      | 占用存储 (Bytes) | 有符号取值范围             | 无符号取值范围   | 用途备注   |
| --------- | ---------------- | -------------------------- | ---------------- | ---------- |
| TINYINT   | 1                | (-128 , 127)               | (0 , 255)        | 小整数值   |
| SMALLINT  | 2                | (-32768 , 32767)           | (0 , 65535)      | 大整数值   |
| MEDIUMINT | 3                | (-8388608 , 8388607)       | (0 , 16777215)   | 大整数值   |
| INT       | 4                | (-2147483648 , 2147483647) | (0 , 4294967295) | 大整数值   |
| BIGINT    | 8                | (-2^63 , 2^63-1)           | (0 , 2^64-1）    | 超大整数值 |

```sql
CREATE  TABLE demo_test (
    id INT(11) NOT NULL AUTO_INCREMENT,
    a  INT(11)  NOT NULL,
    b  INT(11) UNSIGNED ZEROFILL NOT NULL,
    PRIMARY KEY (`id`)
);
-- 对于Integer类型括号中的数字称为字段的显示宽度。显示宽度并不影响可以存储在该列中的最大值。INT(5) 和 INT(11)可以存储相同的最大值，都是INT最大值。
-- int(11)表示显示宽度，当列设置为UNSIGNED ZEROFILL时，INT(11)才有意义，其表示的意思为如果要存储的数字少于11个字符，则这些数字将在左侧补零。

INSERT INTO demo_a(a,b) VALUES(1, 1);
-- 查询时，显示的宽度是11位数
mysql> SELECT * FROM demo_a;
+----+---+-------------+
| id | a | b           |
+----+---+-------------+
|  1 | 1 | 00000000001 |
+----+---+-------------+
1 row in set (0.18 sec)

```





### 定点型类型（精确值）

DECIMAL 和 NUMERIC 类型能存储精确的数值数据。**可以存小数位**。这些类型适用于重视精确度的需求，如货币数据。



| 类型    | 占用存储 (Bytes) | 有符号取值范围 | 无符号取值范围 | 说明备注     |
| ------- | ---------------- | -------------- | -------------- | ------------ |
| float   | 4 bytes          |                |                | 单精度浮点数 |
| double  | 8 bytes          |                |                | 双精度浮点数 |
| decimal |                  |                |                | 定点型       |

```SQL
-- 浮点类型和定点类型都可以用 TYPE(M, D)来表示，其中M称为精度，表示总共的位数；D称为标度，表示小数的位数。
-- FLOAT(7,4) 表示 -999.9999
-- 不论是定点还是浮点类型，如果用户指定的精度超出精度范围，则会四舍五入进行处理。
-- FLOAT 和 DOUBLE 在不指定精度时，默认会按照实际的精度（由计算机硬件和操作系统决定），DECIMAL 如果不指定精度，默认为（10，0）。
-- DOUBLE 实际上是以字符串的形式存放的，DECIMAL 可能的最大取值范围与 DOUBLE 相同，但是有效的取值范围由 M 和 D 决定。如果改变 M 而固定 D，则取值范围将随 M 的变大而变大。

-- 浮点数相对于定点数的优点是在长度一定的情况下，浮点数能够表示更大的范围；缺点是会引起精度问题。
-- 在MySQL中，定点数以字符串形式存储，在对精度要求比较高的时候（如货币、科学数据），使用 DECIMAL 的类型比较好，另外两个浮点数进行减法和比较运算时也容易出问题，所以在使用浮点数时需要注意，并尽量避免做浮点数比较。
```


## 字符和字符串类型



| 类型       | M取值范围  | M含义 | 说明备注               |
| ---------- | ---------- | ----- | ---------------------- |
| CHAR(M)    | 0-255      |       | 固定长度非二进制字符串 |
| VARCHAR(M) | (0, 65535] |       | 变长非二进制字符串     |
| TINYTEXT   |            |       | 定点型                 |
| `TEXT`     | (0, 65535] |       |                        |

- 在MySQL5.0以后的版本中，**M 表示当前字段的字符集编码下，字符的个数，也叫列长度。对于不同的字符集编码，单个字符所占用的空间可能有所不同。**
- **无论什么字符集，无论什么类型的字符串，表中的一行数据的所有列加在一起最字节大长度限制为`65535`个byte。**
  - 如果表只有一个utf8mb4编码的VARCHAR列，列最大字符长度为 65535/4 = 16383 
  - 如果有多个列，则所有列加在一起占用的字节数不能大于 65535
- 对于不同的字符集的字段，varchar类型的列最大字符数量如下：

| 字符集  | 单个字符字节数 | VARCHAR 最大列长度的取值范围(字符个数) | 能否中文 |
| :------ | :------------- | :------------------------------------- | -------- |
| ascii   | 1              | (0, 65535]                             | 不能     |
| latin1  | 1              | (0, 65535]                             |          |
| binary  | 1              | (0, 65535]                             |          |
| utf8    | 3              | (0, 21845]                             |          |
| utf8mb4 | 4              | (0, 16383]                             |          |
|         |                |                                        |          |



|   **插入值**   | **CHAR(4)存入值** | **CHAR(4)占据空间** | **VARCHAR(4)存入值** | **VARCHAR(4)占据空间** |
| :------------: | :---------------: | :-----------------: | :------------------: | :--------------------: |
| `''`(空字符串) |       `' '`       |       4 bytes       |         `''`         |         1 byte         |
|     `'ab'`     |      `'ab '`      |       4 bytes       |        `'ab'`        |        3 bytes         |
|    `'abcd'`    |     `'abcd'`      |       4 bytes       |       `'abcd'`       |        5 bytes         |
|  `'abcdefgh'`  |     `'abcd'`      |       4 bytes       |       `'abcd'`       |        5 bytes         |

- 对于定长字符串类型，无论插入多长



#### MySQL 为什么默认定义varchar(255) 而不是varchar(256)

我们在定义一个字段varchar(n)的时候，数据库在底层要知道这个字段的最大长度是多少。**这个有点像元数据。**

- 我们定义为varchar(1)，那么他就知道这个字段的长度为1，底层要记录好这个1；

- 我们定义为varchar(255)，那么他就知道这个字段的长度为255，底层要记录好这个255；

- 我们定义为varchar(256)，那么他就知道这个字段的长度为256，底层要记录好这个256；

数据在底层存储的时候，它不是直接把1或255这样的整数直接以十进制的方式存储的，它是把1和255这样的整数转换为2进制的方式来存储的，全部都是0或1的方式来存储。

**关于字段长度标识的元数据，如果是255，用tinyint来标识，元数据占用一个字节。如果超过255，要用smallint来标识，元数据占用两个字节。**

  

 **当实际长度大于255的时候，varchar变长字段长度列表需要用两个字节存储描述，也就意味着每一行数据都会增加1个字节，所以在我们的数据长度不可能超过255的情况下，我们尽量不要创建超过255长度的varchar类型的字段。**

当我们定义一个varchar(255)的字段时，其实它真实使用的空间是256（255+1）字节；（**注意，字段非空，latin1编码**）

当我们定义一个一个varchar(256)字段时，它真实使用的空间是258（256+2）字节



```sql
--验证


-- 试着创建一个字段长度超过mysql限制的表，从系统提示知道，列长度不能超过65535
mysql> create table test_varchar_length(v varchar(65536) not null) CHARSET=latin1;
ERROR 1074 (42000): Column length too big for column 'v' (max = 65535); use BLOB or TEXT instead

-- 创建一个字段长度小于max, 65534的表，继续失败
mysql> create table test_varchar_length(v varchar(65534) not null) CHARSET=latin1;
ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, not counting BLOBs, is 65535. This includes storage overhead, check the manual. You have to change some columns to TEXT or BLOBs



-- 创建一个65533的表，65533+2=65535(max), 成功
mysql> create table test_varchar_length(v varchar(65533) not null) CHARSET=latin1;
Query OK, 0 rows affected (0.05 sec)
```





## 日期类型



## 空间类型

## JSON类型





## 选择正确的数据类型

选择的原则是：
- 更小的更好：更小的数据类型通常更快，因为它们占用更少的磁盘、内存和CPU缓存，并且处理时需要的CPU周期也更少。
- 尽量避免NULL：
- 整形比字符操作代价更低。
- 保存日期格式时，要选用MySQL内置的日志格式（TimeStamp, DateTime），而不使用字符串。
- 小数点的保存如何有涉及到运算，用float和double可能会精度不准，可以考虑将小数乘于相应的倍数，然后用BIGINT来存储。








## 数据类型转换