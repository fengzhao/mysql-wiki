<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MySQL WIKI"><meta name=author content=fengzhao><link href=https://mysql.fengzhao.me/optimize/1.overview/ rel=canonical><link href=../../foundmental/1.MySQL%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90%E4%B8%8E%E6%8A%93%E5%8C%85%E6%A6%82%E8%BF%B0/ rel=prev><link href=../many_tables/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.17"><title>调优概述 - MySQL WIKI</title><link rel=stylesheet href=../../assets/stylesheets/main.bcfcd587.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title="MySQL WIKI" class="md-header__button md-logo" aria-label="MySQL WIKI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MySQL WIKI </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 调优概述 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/fengzhao/mysql-wiki title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fengzhao/mysql-wiki </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../resources/ class=md-tabs__link> 学习资源 </a> </li> <li class=md-tabs__item> <a href=../../basic/0.mysql_source/ class=md-tabs__link> MySQL入门 </a> </li> <li class=md-tabs__item> <a href=../../sql/sql2023/ class=md-tabs__link> SQL特性 </a> </li> <li class=md-tabs__item> <a href=../../foundmental/2.MySQL%E7%B4%A2%E5%BC%95/ class=md-tabs__link> MySQL基础 </a> </li> <li class=md-tabs__item> <a href=../../advanced/1.MySQL%E6%9E%B6%E6%9E%84%E5%88%B0InnoDB%E6%9E%B6%E6%9E%84/ class=md-tabs__link> MySQL高级 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> MySQL调优 </a> </li> <li class=md-tabs__item> <a href=../../postgresql/01.postgresql%E7%AE%80%E4%BB%8B/ class=md-tabs__link> PostgreSQL </a> </li> <li class=md-tabs__item> <a href=../../mongodb/01.%E7%AE%80%E4%BB%8B/ class=md-tabs__link> MongoDB </a> </li> <li class=md-tabs__item> <a href=../../redis/01.redis%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Redis </a> </li> <li class=md-tabs__item> <a href=../../%E7%AE%97%E6%B3%95/01.%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0/ class=md-tabs__link> 算法 </a> </li> <li class=md-tabs__item> <a href=../../oracle/01.Oracle%E6%A6%82%E8%BF%B0/ class=md-tabs__link> Oracle </a> </li> <li class=md-tabs__item> <a href=../../network/1.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A6%82%E8%BF%B0/ class=md-tabs__link> network </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="MySQL WIKI" class="md-nav__button md-logo" aria-label="MySQL WIKI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> MySQL WIKI </label> <div class=md-nav__source> <a href=https://github.com/fengzhao/mysql-wiki title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fengzhao/mysql-wiki </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../resources/ class=md-nav__link> <span class=md-ellipsis> 学习资源 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> MySQL入门 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> MySQL入门 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic/0.mysql_source/ class=md-nav__link> <span class=md-ellipsis> 0. MySQL的起源和分支 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/1.introduce_database/ class=md-nav__link> <span class=md-ellipsis> 1. 数据库概述 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/2.install_mysql/ class=md-nav__link> <span class=md-ellipsis> 2. 安装 MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../basic/3.mysql_execute_command/ class=md-nav__link> <span class=md-ellipsis> 3. MySQL可执行程序 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/4.sql/ class=md-nav__link> <span class=md-ellipsis> 4. SQL语句和语法 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/5.relation/ class=md-nav__link> <span class=md-ellipsis> 5. 关系模型和关系代数 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/6.sql_practice/ class=md-nav__link> <span class=md-ellipsis> 6. SQL题目练习 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/7.MySQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 7. MySQL数据类型 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/8.MySQL%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99/ class=md-nav__link> <span class=md-ellipsis> 8. MySQL字符集和排序规则 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/9.mysql_architecture/ class=md-nav__link> <span class=md-ellipsis> 9. MySQL逻辑架构 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/10.MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/ class=md-nav__link> <span class=md-ellipsis> 10. MySQL存储引擎 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/11.sql-Transaction/ class=md-nav__link> <span class=md-ellipsis> 11. MySQL事务和锁 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/12.MySQL%E5%86%85%E5%AD%98%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 12. MySQL内存概述 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/13.MySQL%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%93%E5%BC%80%E5%92%8C%E5%85%B3%E9%97%AD%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 13. MySQL是如何打开和关闭表 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/14.MySQL%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/ class=md-nav__link> <span class=md-ellipsis> 14. MySQL数据字典 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/15.%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 15. MySQL数据文件格式 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/16.MySQL%E5%88%86%E5%8C%BA%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 16. MySQL分区表 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/17.MySQL%E5%BF%AB%E9%80%9F%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 17. MySQL快速导入数据 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/18.MySQL%E4%B8%B4%E6%97%B6%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 18. MySQL临时表 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> SQL特性 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> SQL特性 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sql/sql2023/ class=md-nav__link> <span class=md-ellipsis> 1.SQL2023新特性 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> MySQL基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> MySQL基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundmental/2.MySQL%E7%B4%A2%E5%BC%95/ class=md-nav__link> <span class=md-ellipsis> 1.索引相关 </span> </a> </li> <li class=md-nav__item> <a href=../../dev/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/ class=md-nav__link> <span class=md-ellipsis> 2.数据库设计 </span> </a> </li> <li class=md-nav__item> <a href=../../dev/03.%E5%9C%A8%E7%BA%BFDDL/ class=md-nav__link> <span class=md-ellipsis> 3.在线DDL </span> </a> </li> <li class=md-nav__item> <a href=../../dev/04.MySQL%E8%BF%9E%E8%A1%A8%E6%9F%A5%E8%AF%A2%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 4.联表算法 </span> </a> </li> <li class=md-nav__item> <a href=../../dev/05.MySQL-insert%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 5.insert语法 </span> </a> </li> <li class=md-nav__item> <a href=../../dev/06.MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 6.MySQL主从复制 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> MySQL高级 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> MySQL高级 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 深入理解innoDB存储引擎 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 深入理解innoDB存储引擎 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/1.MySQL%E6%9E%B6%E6%9E%84%E5%88%B0InnoDB%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 1.MySQL架构到innoDB架构 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/2.InnoDB%E2%80%94%E2%80%94%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 2.InnoDB——简介 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/3.InnoDB%E2%80%94%E2%80%94%E5%85%B3%E9%94%AE%E7%89%B9%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 3.InnoDB关键特性 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/4.InnoDB%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E7%BC%93%E5%86%B2%E6%B1%A0/ class=md-nav__link> <span class=md-ellipsis> 4.InnoDB内存结构——缓冲池 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/5.MySQL%E6%BA%90%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 5.搭建MySQL源代码调试debug环境 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> OLAP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> OLAP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../olap/01.OLAP%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 1.0.OLAP概述 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> MySQL协议分析 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> MySQL协议分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundmental/1.MySQL%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90%E4%B8%8E%E6%8A%93%E5%8C%85%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 1.协议分析概述 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex> <span class=md-ellipsis> MySQL调优 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=true> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> MySQL调优 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 调优概述 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 调优概述 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 一、引言 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 二、如何评级数据库负载情况？ </span> </a> <nav class=md-nav aria-label=二、如何评级数据库负载情况？> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tpc class=md-nav__link> <span class=md-ellipsis> TPC </span> </a> <nav class=md-nav aria-label=TPC> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tpc-h class=md-nav__link> <span class=md-ellipsis> TPC-H </span> </a> </li> <li class=md-nav__item> <a href=#tpc-c class=md-nav__link> <span class=md-ellipsis> TPC-C </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 基准测试的性能指标 </span> </a> <nav class=md-nav aria-label=基准测试的性能指标> <ul class=md-nav__list> <li class=md-nav__item> <a href=#qps class=md-nav__link> <span class=md-ellipsis> QPS </span> </a> </li> <li class=md-nav__item> <a href=#tps class=md-nav__link> <span class=md-ellipsis> TPS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 查询报告 </span> </a> <nav class=md-nav aria-label=查询报告> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 源 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 聚合 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 常用基准测试实际工具 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 三、数据库访问优化法则简介 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../many_tables/ class=md-nav__link> <span class=md-ellipsis> 数据大小 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> PostgreSQL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> PostgreSQL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../postgresql/01.postgresql%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 1. PostgreSQL简介 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/02.postgresql%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 2. PogreSQL安装 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/03.%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 3. PogreSQL体系架构 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/04.postgresql%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4. PogreSQL访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/05.%E5%B8%B8%E7%94%A8SQL/ class=md-nav__link> <span class=md-ellipsis> 5. 常用SQL </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/06.%E7%BB%A7%E6%89%BF%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 6. 继承 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/07.%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 7. 用户自定义函数UDF </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/08.%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 8. 基本数据类型 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/09.%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 9. 可执行程序 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> MongoDB </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> MongoDB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mongodb/01.%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 0. MongoDB概述 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Redis </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Redis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../redis/01.redis%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 0. redis概述 </span> </a> </li> <li class=md-nav__item> <a href=../../redis/02.redis%E5%AE%A2%E6%88%B7%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 2. redis客户端 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> 算法 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> 算法 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../%E7%AE%97%E6%B3%95/01.%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 0. 算法概述 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> Oracle </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Oracle </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../oracle/01.Oracle%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 1.Oracle概述 </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/02.oracle安装.md class=md-nav__link> <span class=md-ellipsis> 2.Oracle安装 </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/03.Oracle体系架构.md class=md-nav__link> <span class=md-ellipsis> 3.Oracle体系架构 </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/04.oracle访问控制.md class=md-nav__link> <span class=md-ellipsis> 4.Oracle访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/05.常用SQL.md class=md-nav__link> <span class=md-ellipsis> 5.常用SQL </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/06.%E8%BE%BE%E6%A2%A6%E4%BC%98%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 6.达梦优化 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_13> <label class=md-nav__link for=__nav_13 id=__nav_13_label tabindex=0> <span class=md-ellipsis> network </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_13_label aria-expanded=false> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> network </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../network/1.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 1.计算机网络概述 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 一、引言 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 二、如何评级数据库负载情况？ </span> </a> <nav class=md-nav aria-label=二、如何评级数据库负载情况？> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tpc class=md-nav__link> <span class=md-ellipsis> TPC </span> </a> <nav class=md-nav aria-label=TPC> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tpc-h class=md-nav__link> <span class=md-ellipsis> TPC-H </span> </a> </li> <li class=md-nav__item> <a href=#tpc-c class=md-nav__link> <span class=md-ellipsis> TPC-C </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 基准测试的性能指标 </span> </a> <nav class=md-nav aria-label=基准测试的性能指标> <ul class=md-nav__list> <li class=md-nav__item> <a href=#qps class=md-nav__link> <span class=md-ellipsis> QPS </span> </a> </li> <li class=md-nav__item> <a href=#tps class=md-nav__link> <span class=md-ellipsis> TPS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 查询报告 </span> </a> <nav class=md-nav aria-label=查询报告> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 源 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 聚合 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 常用基准测试实际工具 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 三、数据库访问优化法则简介 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=_1>数据库调优概述<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <h2 id=_2>一、引言<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>在网上有很多文章介绍数据库优化知识，但是大部份文章只是对某个一个方面进行说明，而对于我们来说这种介绍并不能很好的掌握优化知识，因为很多介绍只是对一些特定的场景优化的，所以反而有时会产生误导或让人感觉不明白其中的奥妙而对数据库优化感觉很神秘。</p> <p>很多人总是问如何学习数据库优化，有没有好的教材之类的问题。在书店也看到了许多数据库优化的专业书籍，但是感觉更多是面向DBA或者是PL/SQL开发方面的知识，个人感觉不太适合普通程序员。而要想做到数据库优化的高手，不是花几周，几个月就能达到的，这并不是因为数据库优化有多高深，而是因为要做好优化一方面需要有非常好的技术功底，对操作系统、存储硬件网络、数据库原理等方面有比较扎实的基础知识，另一方面是需要花大量时间对特定的数据库进行实践测试与总结。</p> <p>作为一个程序员，我们也许不清楚线上正式的服务器硬件配置，我们不可能像DBA那样专业的对数据库进行各种实践测试与总结，但我们都应该非常了解我们SQL的业务逻辑，我们清楚SQL中访问表及字段的数据情况，我们其实只关心我们的SQL是否能尽快返回结果。那程序员如何利用已知的知识进行数据库优化？如何能快速定位SQL性能问题并找到正确的优化方向？</p> <p>本文读者对像：</p> <ul> <li> <p>开发人员：如果你是做数据库开发，那本文的内容非常适合，因为本文是从程序员的角度来谈数据库性能优化。</p> </li> <li> <p>架构师：如果你已经是数据库应用的架构师，那本文的知识你应该清楚90%，否则你可能是一个喜欢折腾的架构师。</p> </li> <li> <p>DBA（数据库管理员）：大型数据库优化的知识非常复杂，本文只是从程序员的角度来谈性能优化，DBA除了需要了解这些知识外，还需要深入数据库的内部体系架构来解决问题。</p> </li> </ul> <p>一个数据库系统，其硬件资源(CPU、Disk、SSD...)利用率是不是越高，说明系统调优的越好？</p> <ul> <li> <p>用户关注：响应时间(Latency) Query response time </p> </li> <li> <p>老板关注：资源有没有浪费？</p> </li> <li> <p>调优关注：保证用户响应时间的基础上，最大限度提高资源利用率。</p> </li> </ul> <h2 id=_3>二、如何评级数据库负载情况？<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p><strong>基准测试</strong></p> <p><strong>基准测试-benchmarking</strong> 是一种测量和评估软件性能指标的活动。 你可以在某个时候通过基准测试建立一个已知的性能水平（称为基准线），当系统的软硬件环境发生变化之后再进行一次基准测试以确定那些变化对性能的影响。 这是基准测试最常见的用途。其他用途包括测定某种负载水平下的性能极限、管理系统或环境的变化、发现可能导致性能问题的条件，等等。</p> <p><code>基准测试</code>的具体做法是：在系统上运行一系列测试程序并把性能计数器的结果保存起来。这些结构称为"性能指标"。 性能指标通常都保存或归档，并在系统环境的描述中进行注解。比如说，有经验的数据库专业人员会把基准测试的结果以及当时的系统配置和环境一起存入他们的档案。这可以让他们对系统过去和现在的性能表现进行对照比较，确认系统或环境的所有变化。</p> <p><strong>基准测试工具和标准</strong></p> <h3 id=tpc>TPC<a class=headerlink href=#tpc title="Permanent link">&para;</a></h3> <p><strong>TPC简介</strong></p> <p>事务处理性能委员会（ Transaction ProcessingPerformance Council ），是由数10家会员公司创建的非盈利组织，总部设在美国。该组织对全世界开放，但迄今为止，绝大多数会员都是美、日、西欧的大公司。</p> <p>TPC的成员主要是计算机软硬件厂家，而非计算机用户，它的功能是制定商务应用基准程序（Benchmark）的标准规范、性能和价格度量，并管理测试结果的发布。</p> <p>TPC-C用于测试数据库系统的事务处理能力，TPC-App用于测试7×24 环境下B2B的应用服务和Web服务的能力。</p> <p>TPC 组织还发布过TPC-S（Server 专门测试基准程序）、TPC-E（大型企业信息服务测试基准程序）和TPC-Client/Server等测试标准，但这3个标准不被业界接受而被放弃。</p> <p>TPC不给出基准程序的代码，而只给出基准程序的标准规范（Standard Specification）。任何厂家或其它测试者都可以根据规范，最优地构造出自己的系统（测试平台和测试程序）。（需要自己写测试工具，测试完之后提交给TPC协会）为保证测试结果的客观性，被测试者（通常是厂家）必须提交给TPC一套完整的报告（FullDisclosure Report），包括被测系统的详细配置、分类价格和包含五年维护费用在内的总价格。该报告必须由TPC授权的审核员核实（TPC本身并不做审计），现在全球只有不到十个审核员，全部在美国。（测试价格昂贵的原因）</p> <p><strong>TPC目前推出的基准程序</strong></p> <p>TPC推出过11套基准程序，分别是正在使用的TPC-App、TPC-H、TPC-C、TPC-W，过时的TPC-A、TPC-B、TPC-D和TPC-R，以及因为不被业界接受而放弃的TPC-S（Server专门测试基准程序）、TPC-E（大型企业信息服务测试基准程序）和TPC-Client/Server。这里重点介绍TPC-H。</p> <h4 id=tpc-h>TPC-H<a class=headerlink href=#tpc-h title="Permanent link">&para;</a></h4> <p><strong>TPC-H的目的</strong></p> <p>TPC-H是一个决策支持基准（Decision Support Benchmark），由一套面向业务的临时查询（ad-hoc queries）和并发数据修改（concurrent data modifications）组成。选择的查询和填充数据库的数据具有广泛的行业相关性。该基准测试说明了决策支持系统可以检查大量数据，执行高度复杂的查询，并解答关键的业务问题。</p> <p>TPC-H要目的是评价特定查询的决策支持能力，强调服务器在数据挖掘、分析处理方面的能力。查询是决策支持应用的最主要应用之一，数据仓库中的复杂查询可以分成两种类型：一种是预先知道的查询，如定期的业务报表；另一种则是事先未知的查询，称为动态查询（Ad- Hoc Query）。</p> <p>通俗的讲，TPC-H就是当一家数据库开发商开发了一个新的数据库操作系统，采用TPC-H作为测试基准，来测试衡量数据库操作系统查询决策支持方面的能力。</p> <p><strong>TPC-H的衡量指标</strong></p> <p>它模拟决策支持系统中的数据库操作，测试数据库系统复杂查询的响应时间，以每小时执行的查询数(TPC-H QphH@Siz)作为度量指标。</p> <p><strong>TPC-H标准规范</strong></p> <p>TPC-H标准规范由10章正文和5个附录组成。详细内容见 <a href=https://www.tpc.org/TPC_Documents_Current_Versions/pdf/TPC-H_v3.0.1.pdf>https://www.tpc.org/TPC_Documents_Current_Versions/pdf/TPC-H_v3.0.1.pdf</a></p> <p><strong>数据库运行的环境条件</strong></p> <p>TPC-H测试模型为数据库服务器<code>连续7×24</code>小时工作，可能只有<code>1次/月</code>的维护；多用户并发执行复杂的动态查询，同时有并发执行表修改操作。</p> <p>数据库模型共有8张表，除Nation和Region表外，其它表与测试的数据量有关，即比例因SF（Scale Factor）</p> <p>TPC-H是业界常用的一套Benchmark，由TPC委员会制定发布，用于评测数据库的分析型查询能力。</p> <p><strong>数据模型</strong></p> <p>TPC-H查询包含8张数据表、22条复杂的SQL查询，大多数查询包含若干表Join、子查询和Group-by聚合等。</p> <p>从MySQL官网搞了一份<a href=../ddl.sql>ddl.sql</a></p> <p><img alt=TPC-H_schema src=../TPC-H_schema.png></p> <p><strong>数据规模</strong></p> <p>由于数据量的大小对查询速度有直接的影响，<code>TPC-H</code>标准对数据库系统中的数据量有严格、明确的规定。</p> <p>用<code>SF</code>描述数据量，1SF对应1GB单位，SF由低到高依次是1、10、30、100、300、1000、3000、10000。需要强调，SF规定的数据量只是8个基本表的数据量，不包括索引和临时表。</p> <p>从<code>TPC-H</code>测试全程来看，需要的数据存储空较大，一般包括有基本表、索引、临时表、数据文件和备份文件，基本表的大小为x；索引和临时空间的经验值为3-5位，取上限5x；DBGEN产生的数据文件的大小为x；备份文件大小为x；总计需要的存储空间为8x。就是说SF=1，需要准备8倍，即8GB存储空间，才能顺利地进行测试.</p> <p><strong>查询语句</strong></p> <p>TPC-H测试围绕22个SELECT语句展开，每个<code>SELECT</code>严格定义，遵守SQL-92语法，并且不允许用户修改。标准中从4个方面定义每个<code>SELECT</code>语句，即商业问题、<code>SELECT</code>的语法、参数和查询确认。这些<code>SELECT</code>语句的复杂程度超过大多数实际的<code>OLTP</code>应用，一个<code>SELECT</code>执行时间少则几十秒，多则达15小时以上，22个查询语句执行一遍需数个小时。</p> <p>Q1语句是查询lineItems的一个定价总结报告。在单个表lineitem上查询某个时间段内，对已经付款的、已经运送的等各类商品进行统计，包括业务量的计费、发货、折扣、税、平均价格等信息。</p> <p>Q1语句的特点是：带有分组、排序、聚集操作并存的单表查询操作。这个查询会导致表上的数据有95%到97%行被读取到。</p> <p>Q1的查询语句如下：</p> <div class=highlight><pre><span></span><code><span class=k>SELECT</span><span class=w> </span>
<span class=w>    </span><span class=n>l_returnflag</span><span class=p>,</span><span class=w> </span><span class=c1>-- 返回标志</span>
<span class=w>    </span><span class=n>l_linestatus</span><span class=p>,</span><span class=w> </span>
<span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>l_quantity</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>sum_qty</span><span class=p>,</span><span class=w> </span><span class=c1>-- 总的数量</span>
<span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>l_extendedprice</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>sum_base_price</span><span class=p>,</span><span class=w> </span><span class=c1>-- 聚集函数操作</span>
<span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>l_extendedprice</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>l_discount</span><span class=p>))</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>sum_disc_price</span><span class=p>,</span><span class=w> </span>
<span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>l_extendedprice</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>l_discount</span><span class=p>)</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>l_tax</span><span class=p>))</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>sum_charge</span><span class=p>,</span><span class=w> </span>
<span class=w>    </span><span class=k>AVG</span><span class=p>(</span><span class=n>l_quantity</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>avg_qty</span><span class=p>,</span><span class=w> </span>
<span class=w>    </span><span class=k>AVG</span><span class=p>(</span><span class=n>l_extendedprice</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>avg_price</span><span class=p>,</span><span class=w> </span>
<span class=w>    </span><span class=k>AVG</span><span class=p>(</span><span class=n>l_discount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>avg_disc</span><span class=p>,</span><span class=w> </span>
<span class=w>    </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>count_order</span><span class=w> </span><span class=c1>-- 每个分组所包含的行数</span>
<span class=k>FROM</span><span class=w> </span>
<span class=w>    </span><span class=n>lineitem</span>
<span class=k>WHERE</span><span class=w> </span>
<span class=w>    </span><span class=n>l_shipdate</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=nb>date</span><span class=s1>&#39;1998-12-01&#39;</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nb>interval</span><span class=w> </span><span class=s1>&#39;90&#39;</span><span class=w> </span><span class=k>day</span><span class=w> </span><span class=c1>-- 时间段是随机生成的</span>
<span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=c1>-- 分组操作</span>
<span class=w>    </span><span class=n>l_returnflag</span><span class=p>,</span><span class=w> </span>
<span class=w>    </span><span class=n>l_linestatus</span>
<span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=c1>-- 排序操作</span>
<span class=w>    </span><span class=n>l_returnflag</span><span class=p>,</span><span class=w> </span>
<span class=w>    </span><span class=n>l_linestatus</span><span class=p>;</span>
</code></pre></div> <h4 id=tpc-c>TPC-C<a class=headerlink href=#tpc-c title="Permanent link">&para;</a></h4> <p>TPC-C是业界常用的一套Benchmark，由TPC委员会制定发布，用于评测数据库的联机交易处理（偏向OLTP能力）。</p> <p><a href=https://www.tpc.org/tpcc/ >TPC-C</a>是TPC（事务处理性能委员会）推出的一系列性能测试标准中的一款，自1992年推出，便成为了数据库性能测试的标杆，各个数据库大厂都向TPC委员会提交了测试结果，以期在TPC-C测试的排行榜上拥有一席之地。就像决战紫禁之巅，论剑华山之巅，拥有一席之地的都是成名的大佬们。</p> <p>主要涉及10张表，包含了NewOrder（新订单的生成）、Payment（订单付款）、OrderStatus（最近订单查询）、Delivery（配送）和StockLevel（库存缺货状态分析）等五类业务事务模型。</p> <p>概括来讲，TPC-C是用来衡量在线事务处理的基准，TPC-C提供了一个<a href=https://www.tpc.org/tpc_documents_current_versions/pdf/tpc-c_v5.11.0.pdf>说明书</a>，用来描述这个基准，在写这篇文章的时候，该说明书的版本是于2010年发布的5.11.0，可以通过访问TPC的网站来获取最新的说明书。</p> <p>TPC-C模型是模拟一个商品批发公司的销售模型，这个模型涵盖了一个批发公司面向客户对一系列商品进行销售的过程，这包括管理订单，管理库存，管理账号收支等操作。这些操作涉及到仓库、商品、客户、订单等概念，围绕这些概念，构造了数据表格，以及相应的数据库操作。</p> <p>TPC-C测试规范中模拟了一个比较复杂并具有代表意义的OLTP应用环境：假设有一个大型商品批发商，它拥有若干个分布在不同区域的商品库；每个仓库负责为10个销售点供货；每个销售点为3000个客户提供服务；每个客户平均一个订单有10项产品；所有订单中约1%的产品在其直接所属的仓库中没有存货，需要由其他区域的仓库来供货。</p> <p>TPC-C的批发操作在概念上包括5个操作，新订单操作、付款操作、订单状态操作、发货操作，库存操作，这些操作一起构成了完整的批发流程，其中新订单操作是用来衡量tpmC的核心，也就是数据库系统每分钟所能处理的交易数量。下面，我们将详细讲述TPCC的数据库设计与特点，以及各个操作的组成。</p> <ul> <li> <p>New-Order：客户输入一笔新的订货交易；</p> </li> <li> <p>Payment：更新客户账户余额以反映其支付状况；</p> </li> <li> <p>Delivery：发货(模拟批处理交易)；</p> </li> <li> <p>Order-Status:查询客户最近交易的状态；</p> </li> <li> <p>Stock-Level:查询仓库库存状况，以便能够及时补货。</p> </li> </ul> <p>TPC-C使用tpmC值（Transactions per Minute）来衡量系统最大有效吞吐量（MQTh，Max Qualified Throughput），其中Transactions以NewOrder Transaction为准，即最终衡量单位为每分钟处理的新订单数。</p> <p>TPC-C是一种旨在衡量联机事务处理（OLTP）系统性能与可伸缩性的行业标准基准测试项目。这种基准测试项目将对包括查询、更新及队列式小批量事务在内的广泛数据库功能进行测试。许多IT专业人员将TPC-C视为衡量“真实”OLTP系统性能的有效指示器。</p> <p>该系统需要处理的交易为以下几种：</p> <p>New-Order：客户输入一笔新的订货交易；</p> <p>Payment:更新客户账户余额以反映其支付状况;</p> <p>Delivery:发货(模拟批处理交易);</p> <p>Order-Status:查询客户最近交易的状态；</p> <p>Stock-Level:查询仓库库存状况，以便能够及时补货。</p> <p>对于前四种类型的交易，要求响应时间在5秒以内；对于库存状况查询交易，要求响应时间在20秒以内。</p> <p>（2）评测指标</p> <p>TPC-C的测试结果主要有两个指标：</p> <p>tpmC流量指标(Transactions per minute C)，越大越好 按照TPC的定义，流量指标描述了系统在执行Payment、Order-status、Delivery、Stock-Level这四种交易的同时，每分钟可以处理多少个New-Order交易。所有交易的响应时间必须满足TPC-C测试规范的要求。</p> <p>Price/tpmC性价比(Price/Performance)，越小越好 即测试系统价格（指在美国的报价）与流量指标的比值。</p> <p>（3）发布结果</p> <p>各厂商的TPC-C测试结果都按TPC组织规定的两种形式发布：测试结果概要(Executive Summary)和详细测试报告(Full Disclosure Report)。测试结果概要中描述了主要的测试指标、测试环境示意图以及完整的系统配置与报价，而详细测试报告中除了包含上述内容外，还详细说明了整个测试环境的设置与测试过程。</p> <h3 id=_4>基准测试的性能指标<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <p>在衡量一个系统性能时，一定要有可量化的指标，无法量化就无法有效的优化系统性能。系统每秒可以承载多大请求量，每个请求的响应时间，并发数等都是衡量一个系统的关键性能指标。</p> <p><strong>吞吐量-Throughput</strong></p> <p>吞吐量指的是单位时间内的事务处理数。这一直是经典的数据库应用测试指标。（高并发系统必备） 在衡量系统性能一直作为一个经典和重要的指标，适用于多用户的交互式应用，比如Web服务器的多用户访问和数据库的多请求操作。</p> <p>吞吐量常用的计量单位：</p> <ul> <li> <p>每秒事务数（TPS Transactions Per Second）</p> </li> <li> <p>每秒查询数（QPS Query Per Second） ，每秒能够响应的查询次数。</p> </li> </ul> <p>比如，对于Web服务器，用户对某一个页面的一次请求，用户对某系统的一次登录，用户对商品的一次确认支付过程； 对于数据库，一次查询、修改、新增、删除。这些我们都可以看作一个事务或者请求。</p> <h4 id=qps>QPS<a class=headerlink href=#qps title="Permanent link">&para;</a></h4> <p>QPS <code>Queries Per Second</code> 是每秒查询率，是一台服务器每秒能够相应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准, 即每秒的响应请求数，也即是最大吞吐能力。QPS 中的 Q 应该和 SQL 中的 Q 一样，都是广义上的 Query，也就是所有的 <code>SQL</code> 语句。</p> <p>关于这个Q，其实在MySQL上也有两个变量。</p> <div class=highlight><pre><span></span><code><span class=k>show</span><span class=w> </span><span class=k>global</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s1>&#39;Que%&#39;</span>
<span class=o>+</span><span class=c1>---------------+------------+</span>
<span class=o>|</span><span class=w> </span><span class=n>Variable_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Value</span><span class=w>      </span><span class=o>|</span>
<span class=o>+</span><span class=c1>---------------+------------+</span>
<span class=o>|</span><span class=w> </span><span class=n>Queries</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=mi>6173236173</span><span class=w> </span><span class=o>|</span>
<span class=o>|</span><span class=w> </span><span class=n>Questions</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=mi>5451023114</span><span class=w> </span><span class=o>|</span>
<span class=o>+</span><span class=c1>---------------+------------+</span>
<span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>48</span><span class=w> </span><span class=n>sec</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>Queries

The number of statements executed by the server. This variable includes statements executed within stored programs, unlike the Questions variable. It does not count COM_PING or COM_STATISTICS commands.

The discussion at the beginning of this section indicates how to relate this statement-counting status variable to other such variables.

服务器执行的语句数。此变量包括在存储过程和函数中执行的语句，与Questions变量不同。 它不计算COM_PING或COM_STATISTICS命令


Questions

The number of statements executed by the server. This includes only statements sent to the server by clients and not statements executed within stored programs, unlike the Queries variable. This variable does not count COM_PING, COM_STATISTICS, COM_STMT_PREPARE, COM_STMT_CLOSE, or COM_STMT_RESET commands.

The discussion at the beginning of this section indicates how to relate this statement-counting status variable to other such variables.

服务器执行的语句数。仅包括由客户端发送到服务器的语句，而不包括在存储过程和存储函数中执行的语句，这与Queries变量不同。 

此变量不计算COM_PING，COM_STATISTICS，COM_STMT_PREPARE，COM_STMT_CLOSE或COM_STMT_RESET命令
</code></pre></div> <p>从定义上看着Queries是包含存储过程，并且不包含 <code>com_ping</code> 和 <code>com_statistics</code> ，而Questions 则是包含大量Com 操作的。那到底使用那个作为展示的参数？ 一般会使用 quersions 的值作为一个监控值，例如pmm 中并没有 queries 而选择显示的是 questions 作为一个数据库执行语句的监控值。</p> <h4 id=tps>TPS<a class=headerlink href=#tps title="Permanent link">&para;</a></h4> <p>TPS <code>Transactions Per Second</code> 也就是事务数/秒</p> <p>从web应用的角度来说，包括了</p> <p>1）用户通过client工具，开始发起请求 2）client工具执行N个服务端的API调用 3）client进行API结果的聚合再渲染，最后呈现给用户。</p> <p>这三个过程组成一个事务，每秒能够完成N事务，Tps也就是N。</p> <p><strong>响应时间或延迟</strong></p> <p>这个指标用于测试任务所需的整体时间。根据具体的应用，测试的时间单位可能是微秒，毫秒，秒，分钟。 根据不同的时间单位可以计算出平均响应时间，最小响应时间，最大响应时间和所占的百分比。 通常比较多使用的百分比响应时间，例如：95%的响应时间都是5毫秒，则表示任务在95%的时间段内都可以在5毫秒之内完成。 将响应时间绘制成折线图或散点图或直方图 ，可以直观地表现出数据结果集的分布情况。</p> <p>查询响应时间(Query response time )是指MySQL执行查询所需的时间。同义词包括响应时间(response time)、查询时间(query time)、执行时间(execution time)，以及（不准确地说）查询延迟(query latency)。</p> <p>计时开始于MySQL接收查询，结束于它将结果集发送给客户端。</p> <h3 id=_5>查询报告<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>查询，包括许多阶段（查询执行中的步骤）和等待（锁等待、I/O等待等），但是完整而详细的分解既不可能也不必要。</p> <p>与许多系统一样，基本的故障排除和分析可以揭示大部分问题。</p> <p>查询指标提供了有关查询执行的宝贵洞见，包括响应时间、锁定时间、检查的行数等等。</p> <p>但是与所有指标一样，查询指标是原始值，需要被收集、汇总，并以对工程师有意义（且易读）的方式呈现。</p> <p>这正是本节的内容：查询指标工具如何将查询指标转化为查询报告。但是查询报告只是达到目的的手段之一。</p> <h4 id=_6>源<a class=headerlink href=#_6 title="Permanent link">&para;</a></h4> <p>查询指标来自 <code>慢查询日志</code> 和 <code>performance_schema</code> , 后者可能是最好的查询指标数据来源。</p> <p>MySQL慢查询日志是MySQL提供的一种日志记录，用来记录执行时长超过指定时长的查询语句，具体指运行时间超过 long_query_time 值的 SQL 语句，则会被记录到慢查询日志中。</p> <div class=highlight><pre><span></span><code><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span>
<span class=n>mysql</span><span class=o>&gt;</span><span class=w>  </span><span class=k>SHOW</span><span class=w> </span><span class=n>VARIABLES</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=s1>&#39;%query%&#39;</span><span class=p>;</span>
<span class=o>+</span><span class=c1>------------------------------+-------------------------------------+</span>
<span class=o>|</span><span class=w> </span><span class=n>Variable_name</span><span class=w>                </span><span class=o>|</span><span class=w> </span><span class=n>Value</span><span class=w>                               </span><span class=o>|</span>
<span class=o>+</span><span class=c1>------------------------------+-------------------------------------+</span>
<span class=o>|</span><span class=w> </span><span class=n>binlog_rows_query_log_events</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>OFF</span><span class=w>                                 </span><span class=o>|</span>
<span class=o>|</span><span class=w> </span><span class=n>ft_query_expansion_limit</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=mi>20</span><span class=w>                                  </span><span class=o>|</span>
<span class=o>|</span><span class=w> </span><span class=n>have_query_cache</span><span class=w>             </span><span class=o>|</span><span class=w> </span><span class=k>NO</span><span class=w>                                  </span><span class=o>|</span>
<span class=o>|</span><span class=w> </span><span class=n>long_query_time</span><span class=w>              </span><span class=o>|</span><span class=w> </span><span class=mi>10</span><span class=p>.</span><span class=mi>000000</span><span class=w>                           </span><span class=o>|</span>
<span class=o>|</span><span class=w> </span><span class=n>query_alloc_block_size</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=mi>8192</span><span class=w>                                </span><span class=o>|</span>
<span class=o>|</span><span class=w> </span><span class=n>query_prealloc_size</span><span class=w>          </span><span class=o>|</span><span class=w> </span><span class=mi>8192</span><span class=w>                                </span><span class=o>|</span>
<span class=o>|</span><span class=w> </span><span class=n>slow_query_log</span><span class=w>               </span><span class=o>|</span><span class=w> </span><span class=k>OFF</span><span class=w>                                 </span><span class=o>|</span>
<span class=o>|</span><span class=w> </span><span class=n>slow_query_log_file</span><span class=w>          </span><span class=o>|</span><span class=w> </span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=n>mysql</span><span class=o>/</span><span class=k>data</span><span class=o>/</span><span class=n>localhost</span><span class=o>-</span><span class=n>slow</span><span class=p>.</span><span class=n>log</span><span class=w> </span><span class=o>|</span>
<span class=o>+</span><span class=c1>------------------------------+-------------------------------------+</span>
<span class=mi>8</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span>

<span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># slow logging</span>
<span class=nv>slow_query_log</span><span class=o>=</span><span class=m>1</span><span class=w>    </span><span class=c1>## 是否启用慢查询日志，[1 | 0] 或者 [ON | OFF]， MySQL 5.6以前此参数应该为log_slow_queries</span>
log-output<span class=o>=</span>FILE<span class=w>     </span><span class=c1>## 指定用文件存储或者用数据表存储，与通用查询日志共用这个参数，日志记录到系统的专用日志表中，要比记录到文件耗费更多的系统资源，因此对于需要启用慢查询日志，又需要能够获得更高的系统性能，那么建议优先记录到文件。</span>


slow_query_log_file<span class=w>  </span><span class=c1>## 指定文件存储路径和文件名，一般在数据目录下，默认是/var/lib/mysql/hostname-slow.log。</span>

<span class=nv>long_query_time</span><span class=o>=</span><span class=m>10</span><span class=w>    </span><span class=c1>## 慢查的时长单位为秒，默认是10秒。可以精确到小数点后6位(微秒)。</span>
log_queries_not_using_indexes<span class=w>  </span><span class=c1>## 没有使用到索引的语句，是否被记录到慢查询日志中。</span>
log_timestamps<span class=w>      </span><span class=c1>## 主要是控制 error log、genera log，等等记录日志的显示时间参数。默认时间戳是utc时间。与北京时间相差8h，一般我们会设置成SYSTEMd为操作系统时间。</span>
</code></pre></div> <p>慢查询日志开销比较小，通过对慢查询的分析可以到系统的性能问题，找到相关的sql语句并进一步优化，因为或多或少都有一些性能开销，所以如果不是为了调优，一般建议不用开启。</p> <p>对于 8.0.14 之前，慢查询日志仅提供了 Query_time , Lock_time , Rows_sent , Rows_examined 这四个指标。</p> <h4 id=_7>聚合<a class=headerlink href=#_7 title="Permanent link">&para;</a></h4> <p>查询指标可以分组和聚合。但是有些查询指标工具可以按用户名、主机名、数据库等进行分组。这些备选分组非常罕见，并且产生了一种不同类型的查询分析。</p> <p>由于查询响应时间是MySQL性能的"北极星"，将查询指标按查询进行分组是查看哪些查询具有最慢响应时间的最佳方式，这构成了查询报告和分析的基础。</p> <p>如何唯一标识查询，以确定它们属于哪些分组呢？例如，系统指标（CPU、内存、存储等）按主机名进行分组，因为主机名是唯一且有意义的。</p> <p>但是，查询没有像主机名那样唯一标识的属性。解决办法是使用SQL语句的标准化形式的摘要。并对摘要文本计算其SHA-256哈希值。</p> <p><code>DIGEST TEXT</code> 本质是一种SQL语句规范化后将常量替换成'?'的运算结果，<code>STATEMENT_DIGEST_TEXT</code>函数用于计算语句的 <code>DIGEST TEXT</code>(摘要文本)，通常我们也可以称呼其为，<strong>SQL指纹：SQL 指纹指将一条 SQL 中的字面值替换成其他固定符号。可以用来做 SQL 脱敏或者 SQL 归类。</strong></p> <p>摘要文本和摘要哈希都是独一无二的。摘要文本以及摘要哈希值的一致性来自于表或者过滤字段的不变性，如果表名或者过滤字段有变化，MySQL 将会归类这些查询语句为不同的摘要。</p> <p>SQL语句被称为查询样本</p> <div class=highlight><pre><span></span><code><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=o>=</span><span class=mi>10</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>quantity</span><span class=o>&gt;</span><span class=mi>20</span>
<span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>20</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>quantity</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>100</span>

<span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>quantity</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=o>?</span>

<span class=c1>-- statement_digest()：计算 SQL 语句的摘要哈希值</span>

<span class=c1>-- statement_digest_text()：返回 SQL 语句对应的摘要文本</span>

<span class=n>f49d50dfab1c364e622d1e1ff54bb12df436be5d44c464a4e25a1ebb80fc2f13</span>
</code></pre></div> <p>MySQL的 <code>PERFORMANCE_SCHEMA</code> 用于在一个较低级别的运行过程中监控MySQL server的资源消耗、资源等待等情况。</p> <p>​特点如下：</p> <ul> <li>提供了一种在数据库运行时实时检查server的内部执行情况的方法。PERFORMANCE_SCHEMA 数据库中的表使用PERFORMANCE_SCHEMA存储引擎。</li> </ul> <p>该数据库主要关注数据库运行过程中的性能相关的数据，与information_schema不同，information_schema主要关注server运行过程中的元数据信息</p> <ul> <li>PERFORMANCE_SCHEMA通过监视server的事件来实现监视server内部运行情况， “事件”就是server内部活动中所做的任何事情以及对应的时间消耗，利用这些信息来判断server中的相关资源消耗在了哪里？</li> </ul> <p>一般来说，事件可以是函数调用、操作系统的等待、SQL语句执行的阶段（如sql语句执行过程中的parsing 或 sorting阶段）或者整个SQL语句与SQL语句集合。事件的采集可以方便的提供server中的相关存储引擎对磁盘文件、表I/O、表锁等资源的同步调用信息。</p> <ul> <li> <p>PERFORMANCE_SCHEMA中的事件与写入二进制日志中的事件（描述数据修改的events）、事件计划调度程序（这是一种存储程序）的事件不同。PERFORMANCE_SCHEMA中的事件记录的是server执行某些活动对某些资源的消耗、耗时、这些活动执行的次数等情况。</p> </li> <li> <p>PERFORMANCE_SCHEMA中的事件只记录在本地server的PERFORMANCE_SCHEMA中，其下的这些表中数据发生变化时不会被写入binlog中，也不会通过复制机制被复制到其他server中。</p> </li> <li> <p>当前活跃事件、历史事件和事件摘要相关的表中记录的信息。能提供某个事件的执行次数、使用时长。进而可用于分析某个特定线程、特定对象（如mutex或file）相关联的活动。</p> </li> <li> <p>PERFORMANCE_SCHEMA存储引擎使用server源代码中的“检测点”来实现事件数据的收集。对于PERFORMANCE_SCHEMA实现机制本身的代码没有相关的单独线程来检测，这与其他功能（如复制或事件计划程序）不同。</p> </li> <li> <p>收集的事件数据存储在PERFORMANCE_SCHEMA数据库的表中。这些表可以使用SELECT语句查询，也可以使用SQL语句更新PERFORMANCE_SCHEMA数据库中的表记录（如动态修改PERFORMANCE_SCHEMA的setup_*开头的几个配置表，但要注意：配置表的更改会立即生效，这会影响数据收集）</p> </li> <li> <p>PERFORMANCE_SCHEMA的表中的数据不会持久化存储在磁盘中，而是保存在内存中，一旦服务器重启，这些数据会丢失（包括配置表在内的整个PERFORMANCE_SCHEMA下的所有数据）</p> </li> <li> <p>MySQL支持的所有平台中事件监控功能都可用，但不同平台中用于统计事件时间开销的计时器类型可能会有所差异。</p> </li> </ul> <p><strong>并发性</strong></p> <p>并发性是一个非重要</p> <h3 id=_8>常用基准测试实际工具<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>SysBench是 Peter Zaitsev 在2004年最开始发明的，很快，Alexey Kopytov 接管了它的开发工作。到<code>0.4.12</code>版本侯就暂停了。</p> <p>Sysbench是一款基准测试工具，最开始被设计为用来对基于硬件服务器上的MySQ的基准性能测试工具。包括CPU，内存，磁盘IO等等。 它也支持在<code>MySQL</code>上的<code>OLTP</code>工作负载的测试，OLTP就是在线事务处理，典型的数据库应用场景。</p> <p>IO测试对应InnoDB的IO性能，注重测试IO密集型 CPU测试对应高并发，多线程的场景，注重测试CPU密集型</p> <p>它可以覆盖到多种场景：OLTP workloads，read-only or read-write, primary key lookups and primary key updates.</p> <p><a href=https://www.cnblogs.com/mingfan/p/14801579.html>BenchmarkSQL测试PostgreSQL</a></p> <h2 id=_9>三、数据库访问优化法则简介<a class=headerlink href=#_9 title="Permanent link">&para;</a></h2> <p>要正确的优化SQL，我们需要快速定位能性的瓶颈点，也就是说快速找到我们SQL主要的开销在哪里？而大多数情况性能最慢的设备会是瓶颈点，如下载时网络速度可能会是瓶颈点，本地复制文件时硬盘可能会是瓶颈点，为什么这些一般的工作我们能快速确认瓶颈点呢，因为我们对这些慢速设备的性能数据有一些基本的认识，如网络带宽是2Mbps，硬盘是每分钟7200转等等。因此，为了快速找到SQL的性能瓶颈点，我们也需要了解我们计算机系统的硬件基本性能指标。</p> <p><img alt=计算机存储结构层次金字塔 src=../../assets/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%B1%82%E6%AC%A1%E9%87%91%E5%AD%97%E5%A1%94.png title=计算机存储结构层次金字塔></p> <p>当今的计算机系统当中，基本上全部都置入了各种各样的存储设备，这些存储设备呈明显的层次结构，它们的特点是容量越大，速度越慢。</p> <p>因此如果按照容量和速度将它们以图示的方式呈现的话，则看起来就像是一个金字塔，上图就是csapp中的著名的 <strong>计算机存储结构层次金字塔</strong> 图。</p> <p>从上图可以看出，计算机系统硬件性能从高到代依次为：</p> <div class=highlight><pre><span></span><code>CPU——Cache(L1-L2-L3)——内存——SSD硬盘——网络——机械硬盘
</code></pre></div> <p>根据数据库知识，我们可以列出每种硬件主要的工作内容：</p> <ul> <li> <p>CPU及内存：缓存数据访问、比较、排序、事务检测、SQL解析、函数或逻辑运算;</p> </li> <li> <p>网络：结果数据传输、SQL请求、数据同步、日志同步等;</p> </li> <li> <p>硬盘：数据访问、数据写入、日志记录、大数据量排序、大表连接。</p> </li> </ul> <p>这个优化法则归纳为5个层次：</p> <ul> <li> <p>减少数据访问（减少磁盘访问）</p> </li> <li> <p>返回更少数据（减少网络传输或磁盘访问）</p> </li> <li> <p>减少交互次数（减少网络传输）</p> </li> <li> <p>减少服务器CPU开销（减少CPU及内存开销）</p> </li> <li> <p>利用更多资源（增加资源）</p> </li> </ul> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="2025年12月24日 05:56:46 UTC">2025-12-24 05:56:46</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyleft &copy; 2020 - 2023 fengzhao </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../assets/javascripts/bundle.1e8ae164.min.js></script> </body> </html>