<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MySQL WIKI"><meta name=author content=fengzhao><link href=https://mysql.fengzhao.me/dev/02.%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/ rel=canonical><link href=../../foundmental/2.MySQL%E7%B4%A2%E5%BC%95/ rel=prev><link href=../03.%E5%9C%A8%E7%BA%BFDDL/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.17"><title>2.数据库设计 - MySQL WIKI</title><link rel=stylesheet href=../../assets/stylesheets/main.bcfcd587.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title="MySQL WIKI" class="md-header__button md-logo" aria-label="MySQL WIKI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MySQL WIKI </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 2.数据库设计 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/fengzhao/mysql-wiki title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fengzhao/mysql-wiki </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../resources/ class=md-tabs__link> MySQL相关资源 </a> </li> <li class=md-tabs__item> <a href=../../basic/0.mysql_source/ class=md-tabs__link> MySQL入门 </a> </li> <li class=md-tabs__item> <a href=../../sql/sql2023/ class=md-tabs__link> SQL特性 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../foundmental/2.MySQL%E7%B4%A2%E5%BC%95/ class=md-tabs__link> MySQL基础 </a> </li> <li class=md-tabs__item> <a href=../../advanced/1.MySQL%E6%9E%B6%E6%9E%84%E5%88%B0InnoDB%E6%9E%B6%E6%9E%84/ class=md-tabs__link> MySQL高级 </a> </li> <li class=md-tabs__item> <a href=../../optimize/1.overview/ class=md-tabs__link> MySQL调优 </a> </li> <li class=md-tabs__item> <a href=../../postgresql/01.postgresql%E7%AE%80%E4%BB%8B/ class=md-tabs__link> PostgreSQL </a> </li> <li class=md-tabs__item> <a href=../../mongodb/01.%E7%AE%80%E4%BB%8B/ class=md-tabs__link> MongoDB </a> </li> <li class=md-tabs__item> <a href=../../redis/01.redis%E7%AE%80%E4%BB%8B/ class=md-tabs__link> Redis </a> </li> <li class=md-tabs__item> <a href=../../%E7%AE%97%E6%B3%95/01.%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0/ class=md-tabs__link> 算法 </a> </li> <li class=md-tabs__item> <a href=../../oracle/01.Oracle%E6%A6%82%E8%BF%B0/ class=md-tabs__link> Oracle </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="MySQL WIKI" class="md-nav__button md-logo" aria-label="MySQL WIKI" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> MySQL WIKI </label> <div class=md-nav__source> <a href=https://github.com/fengzhao/mysql-wiki title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fengzhao/mysql-wiki </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../resources/ class=md-nav__link> <span class=md-ellipsis> MySQL相关资源 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> MySQL入门 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> MySQL入门 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic/0.mysql_source/ class=md-nav__link> <span class=md-ellipsis> 0. MySQL的起源和分支 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/1.introduce_database/ class=md-nav__link> <span class=md-ellipsis> 1. 数据库概述 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/2.install_mysql/ class=md-nav__link> <span class=md-ellipsis> 2. 安装 MySQL </span> </a> </li> <li class=md-nav__item> <a href=../../basic/3.mysql_execute_command/ class=md-nav__link> <span class=md-ellipsis> 3. MySQL可执行程序 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/4.sql/ class=md-nav__link> <span class=md-ellipsis> 4. SQL语句和语法 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/5.relation/ class=md-nav__link> <span class=md-ellipsis> 5. 关系模型和关系代数 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/6.sql_practice/ class=md-nav__link> <span class=md-ellipsis> 6. SQL题目练习 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/7.MySQL%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 7. MySQL数据类型 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/8.MySQL%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99/ class=md-nav__link> <span class=md-ellipsis> 8. MySQL字符集和排序规则 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/9.mysql_architecture/ class=md-nav__link> <span class=md-ellipsis> 9. MySQL逻辑架构和性能优化概述 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/10.MySQL%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/ class=md-nav__link> <span class=md-ellipsis> 10. MySQL存储引擎 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/11.sql-Transaction/ class=md-nav__link> <span class=md-ellipsis> 11. MySQL事务和锁 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/12.MySQL%E5%86%85%E5%AD%98%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 12. MySQL内存概述 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/13.MySQL%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%93%E5%BC%80%E5%92%8C%E5%85%B3%E9%97%AD%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 13. MySQL是如何打开和关闭表 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/14.MySQL%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8/ class=md-nav__link> <span class=md-ellipsis> 14. MySQL数据字典 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/15.%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F/ class=md-nav__link> <span class=md-ellipsis> 15. MySQL数据文件格式 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/16.MySQL%E5%88%86%E5%8C%BA%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 16. MySQL分区表 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/17.MySQL%E5%BF%AB%E9%80%9F%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE/ class=md-nav__link> <span class=md-ellipsis> 14. MySQL快速导入数据 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/Playbook-features.md class=md-nav__link> <span class=md-ellipsis> 15. Playbook 高级特性 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_20> <label class=md-nav__link for=__nav_3_20 id=__nav_3_20_label tabindex=0> <span class=md-ellipsis> 扩展阅读(深入必读) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_20_label aria-expanded=false> <label class=md-nav__title for=__nav_3_20> <span class="md-nav__icon md-icon"></span> 扩展阅读(深入必读) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic/Reference/Yaml.md class=md-nav__link> <span class=md-ellipsis> 1. YAML 语法 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/Reference/Vaults.md class=md-nav__link> <span class=md-ellipsis> 2. Vaults 加密数据 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/Reference/Keywords.md class=md-nav__link> <span class=md-ellipsis> 3. 关键字使用 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/Reference/Module.md class=md-nav__link> <span class=md-ellipsis> 4. 模块索引 </span> </a> </li> <li class=md-nav__item> <a href=../../basic/Reference/Config.md class=md-nav__link> <span class=md-ellipsis> 5. Ansible 配置 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_21> <label class=md-nav__link for=__nav_3_21 id=__nav_3_21_label tabindex=0> <span class=md-ellipsis> Windows </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_21_label aria-expanded=false> <label class=md-nav__title for=__nav_3_21> <span class="md-nav__icon md-icon"></span> Windows </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../basic/Windows/manager-windows.md class=md-nav__link> <span class=md-ellipsis> 1. 管理 Windows 主机 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> SQL特性 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> SQL特性 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sql/sql2023/ class=md-nav__link> <span class=md-ellipsis> 1.SQL2023新特性 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> MySQL基础 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> MySQL基础 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundmental/2.MySQL%E7%B4%A2%E5%BC%95/ class=md-nav__link> <span class=md-ellipsis> 1.索引相关 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 2.数据库设计 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 2.数据库设计 </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 概述 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 数据库设计 </span> </a> <nav class=md-nav aria-label=数据库设计> <ul class=md-nav__list> <li class=md-nav__item> <a href=#er class=md-nav__link> <span class=md-ellipsis> ER 图 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 数据流图 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#uml class=md-nav__link> <span class=md-ellipsis> UML 图 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 范式和反范式 </span> </a> <nav class=md-nav aria-label=范式和反范式> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 范式 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 多值属性 </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 树形结构 </span> </a> <nav class=md-nav aria-label=树形结构> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 邻接表 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 物化路径表 </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 闭包表 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 主键 </span> </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 外键 </span> </a> </li> <li class=md-nav__item> <a href=#eav class=md-nav__link> <span class=md-ellipsis> EAV 模型 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 多列属性 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 设计规约 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../03.%E5%9C%A8%E7%BA%BFDDL/ class=md-nav__link> <span class=md-ellipsis> 3.在线DDL </span> </a> </li> <li class=md-nav__item> <a href=../04.MySQL%E8%BF%9E%E8%A1%A8%E6%9F%A5%E8%AF%A2%E7%AE%97%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 4.联表算法 </span> </a> </li> <li class=md-nav__item> <a href=../05.MySQL-insert%E8%AF%AD%E6%B3%95/ class=md-nav__link> <span class=md-ellipsis> 5.insert语法 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/dynamic-inventory.md class=md-nav__link> <span class=md-ellipsis> 使用动态主机管理云服务 </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 id=__nav_5_7_label tabindex> <span class=md-ellipsis> Ansible 安全 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_7_label aria-expanded=false> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> Ansible 安全 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/security/index.md class=md-nav__link> <span class=md-ellipsis> Ansible 控制节点安全 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/security/firewall.md class=md-nav__link> <span class=md-ellipsis> - 节点安全: 防火墙设置 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/security/ssh-2step.md class=md-nav__link> <span class=md-ellipsis> - 节点安全: ssh登录二次验证 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/security/audit.md class=md-nav__link> <span class=md-ellipsis> - 节点安全: 命令审计 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/security/vault-hosts.md class=md-nav__link> <span class=md-ellipsis> - 节点安全: 加密主机清单 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/security/filter-command.md class=md-nav__link> <span class=md-ellipsis> 过滤 Ansible 危险指令 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_8> <label class=md-nav__link for=__nav_5_8 id=__nav_5_8_label tabindex> <span class=md-ellipsis> Ansible 实践 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_8_label aria-expanded=false> <label class=md-nav__title for=__nav_5_8> <span class="md-nav__icon md-icon"></span> Ansible 实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/practice/snippets.md class=md-nav__link> <span class=md-ellipsis> Ansible Task片段 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/practice/jenkins-and-ansible.md class=md-nav__link> <span class=md-ellipsis> 在 Jenkins 中使用 Ansible </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../advanced/ara.md class=md-nav__link> <span class=md-ellipsis> 使用 ARA 记录 Ansible 执行结果 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/ansible-cmdb.md class=md-nav__link> <span class=md-ellipsis> 使用 Ansible-cmdb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> MySQL高级 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> MySQL高级 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_1> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> <span class=md-ellipsis> 深入理解innoDB存储引擎 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> 深入理解innoDB存储引擎 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../advanced/1.MySQL%E6%9E%B6%E6%9E%84%E5%88%B0InnoDB%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 1.MySQL架构到innoDB架构 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/2.InnoDB%E2%80%94%E2%80%94%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 2.InnoDB——简介 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/3.InnoDB%E2%80%94%E2%80%94%E5%85%B3%E9%94%AE%E7%89%B9%E6%80%A7/ class=md-nav__link> <span class=md-ellipsis> 3.InnoDB关键特性 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/4.InnoDB%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E7%BC%93%E5%86%B2%E6%B1%A0/ class=md-nav__link> <span class=md-ellipsis> 4.InnoDB内存结构——缓冲池 </span> </a> </li> <li class=md-nav__item> <a href=../../advanced/5.MySQL%E6%BA%90%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/ class=md-nav__link> <span class=md-ellipsis> 5.搭建MySQL源代码调试debug环境 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_2> <label class=md-nav__link for=__nav_6_2 id=__nav_6_2_label tabindex=0> <span class=md-ellipsis> OLAP </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_6_2> <span class="md-nav__icon md-icon"></span> OLAP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../olap/01.OLAP%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 1.0.OLAP概述 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_3> <label class=md-nav__link for=__nav_6_3 id=__nav_6_3_label tabindex=0> <span class=md-ellipsis> MySQL协议分析 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_6_3> <span class="md-nav__icon md-icon"></span> MySQL协议分析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../foundmental/1.MySQL%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90%E4%B8%8E%E6%8A%93%E5%8C%85%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 1.协议分析概述 </span> </a> </li> <li class=md-nav__item> <a href=../debug/pdb.md class=md-nav__link> <span class=md-ellipsis> pdb 本地调试 </span> </a> </li> <li class=md-nav__item> <a href=../debug/pycharm.md class=md-nav__link> <span class=md-ellipsis> PyCharm 远程调试 </span> </a> </li> <li class=md-nav__item> <a href=../debug/module-debug.md class=md-nav__link> <span class=md-ellipsis> 模块调试 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_4> <label class=md-nav__link for=__nav_6_4 id=__nav_6_4_label tabindex=0> <span class=md-ellipsis> Module 开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_6_4> <span class="md-nav__icon md-icon"></span> Module 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../modules/index.md class=md-nav__link> <span class=md-ellipsis> Module 开发说明 </span> </a> </li> <li class=md-nav__item> <a href=../modules/remote_copy.md class=md-nav__link> <span class=md-ellipsis> 创建一个简单的module </span> </a> </li> <li class=md-nav__item> <a href=../modules/huawei-switch.md class=md-nav__link> <span class=md-ellipsis> module 示例: 连接华为交换机 </span> </a> </li> <li class=md-nav__item> <a href=../modules/module-outher-dev.md class=md-nav__link> <span class=md-ellipsis> module 示例: 其他语言开发 </span> </a> </li> <li class=md-nav__item> <a href=../modules/module-shell-dir.md class=md-nav__link> <span class=md-ellipsis> module 示例: dir </span> </a> </li> <li class=md-nav__item> <a href=../modules/module-docker-facts.md class=md-nav__link> <span class=md-ellipsis> module 示例: docker_facts </span> </a> </li> <li class=md-nav__item> <a href=../modules/module-wechat.md class=md-nav__link> <span class=md-ellipsis> module 示例: wechat </span> </a> </li> <li class=md-nav__item> <a href=../modules/module-return.md class=md-nav__link> <span class=md-ellipsis> module 的返回值 </span> </a> </li> <li class=md-nav__item> <a href=../modules/module-doc.md class=md-nav__link> <span class=md-ellipsis> module 的帮助文档 </span> </a> </li> <li class=md-nav__item> <a href=../modules/module-architecture.md class=md-nav__link> <span class=md-ellipsis> module 架构 </span> </a> </li> <li class=md-nav__item> <a href=../modules/module-utilities.md class=md-nav__link> <span class=md-ellipsis> module 工具类 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5 id=__nav_6_5_label tabindex=0> <span class=md-ellipsis> Plugin 开发 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_5_label aria-expanded=false> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> Plugin 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../plugins/index.md class=md-nav__link> <span class=md-ellipsis> Plugin 开发说明 </span> </a> </li> <li class=md-nav__item> <a href=../plugins/Action-hello.md class=md-nav__link> <span class=md-ellipsis> Action 示例: hello </span> </a> </li> <li class=md-nav__item> <a href=../plugins/Callback-BlackHole.md class=md-nav__link> <span class=md-ellipsis> Callback 示例: BlackHole </span> </a> </li> <li class=md-nav__item> <a href=../plugins/Filter-split.md class=md-nav__link> <span class=md-ellipsis> Filter 示例: split </span> </a> </li> <li class=md-nav__item> <a href=../plugins/Inventory-csv.md class=md-nav__link> <span class=md-ellipsis> Inventory 示例: csv </span> </a> </li> <li class=md-nav__item> <a href=../plugins/Lookup-github-status.md class=md-nav__link> <span class=md-ellipsis> Lookup 示例: github_status </span> </a> </li> <li class=md-nav__item> <a href=../plugins/Vars-csv-vars.md class=md-nav__link> <span class=md-ellipsis> Vars 示例: csv_vars </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6_6> <label class=md-nav__link for=__nav_6_6 id=__nav_6_6_label tabindex=0> <span class=md-ellipsis> API 使用 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6_6> <span class="md-nav__icon md-icon"></span> API 使用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../api/index.md class=md-nav__link> <span class=md-ellipsis> API 使用说明 </span> </a> </li> <li class=md-nav__item> <a href=../api/api-task.md class=md-nav__link> <span class=md-ellipsis> 使用 API 运行任务 </span> </a> </li> <li class=md-nav__item> <a href=../api/api-playbook.md class=md-nav__link> <span class=md-ellipsis> 使用 API 运行 Palybook </span> </a> </li> <li class=md-nav__item> <a href=../api/api-suitable.md class=md-nav__link> <span class=md-ellipsis> 使用 suitable </span> </a> </li> <li class=md-nav__item> <a href=../api/api-ansible-runner.md class=md-nav__link> <span class=md-ellipsis> 使用 ansible runner </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> MySQL调优 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> MySQL调优 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../optimize/1.overview/ class=md-nav__link> <span class=md-ellipsis> 调优概述 </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/many_tables/ class=md-nav__link> <span class=md-ellipsis> 数据大小 </span> </a> </li> <li class=md-nav__item> <a href=../../ui/awx.md class=md-nav__link> <span class=md-ellipsis> Ansible Awx </span> </a> </li> <li class=md-nav__item> <a href=../../optimize/.md class=md-nav__link> <span class=md-ellipsis> 数据库结构调优 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> PostgreSQL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> PostgreSQL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../postgresql/01.postgresql%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 1. PostgreSQL简介 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/02.postgresql%E5%AE%89%E8%A3%85/ class=md-nav__link> <span class=md-ellipsis> 2. PogreSQL安装 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/03.%E4%BD%93%E7%B3%BB%E6%9E%B6%E6%9E%84/ class=md-nav__link> <span class=md-ellipsis> 3. PogreSQL体系架构 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/04.postgresql%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/ class=md-nav__link> <span class=md-ellipsis> 4. PogreSQL访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/05.%E5%B8%B8%E7%94%A8SQL/ class=md-nav__link> <span class=md-ellipsis> 5. 常用SQL </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/06.%E7%BB%A7%E6%89%BF%E8%A1%A8/ class=md-nav__link> <span class=md-ellipsis> 6. 继承 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/07.%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 7. 用户自定义函数UDF </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/08.%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/ class=md-nav__link> <span class=md-ellipsis> 8. 基本数据类型 </span> </a> </li> <li class=md-nav__item> <a href=../../postgresql/09.%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F/ class=md-nav__link> <span class=md-ellipsis> 9. 可执行程序 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> MongoDB </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> MongoDB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mongodb/01.%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 0. MongoDB概述 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_2> <label class=md-nav__link for=__nav_9_2 id=__nav_9_2_label tabindex=0> <span class=md-ellipsis> 认证 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_2_label aria-expanded=false> <label class=md-nav__title for=__nav_9_2> <span class="md-nav__icon md-icon"></span> 认证 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/auth/kerberos-client.md class=md-nav__link> <span class=md-ellipsis> kerberos-client </span> </a> </li> <li class=md-nav__item> <a href=../../roles/auth/kerberos-server.md class=md-nav__link> <span class=md-ellipsis> kerberos-server </span> </a> </li> <li class=md-nav__item> <a href=../../roles/auth/openldap.md class=md-nav__link> <span class=md-ellipsis> openldap </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Redis </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Redis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../redis/01.redis%E7%AE%80%E4%BB%8B/ class=md-nav__link> <span class=md-ellipsis> 0. redis概述 </span> </a> </li> <li class=md-nav__item> <a href=../../redis/02.redis%E5%AE%A2%E6%88%B7%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 2. redis客户端 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_3> <label class=md-nav__link for=__nav_10_3 id=__nav_10_3_label tabindex=0> <span class=md-ellipsis> 认证 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_3_label aria-expanded=false> <label class=md-nav__title for=__nav_10_3> <span class="md-nav__icon md-icon"></span> 认证 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/auth/kerberos-client.md class=md-nav__link> <span class=md-ellipsis> kerberos-client </span> </a> </li> <li class=md-nav__item> <a href=../../roles/auth/kerberos-server.md class=md-nav__link> <span class=md-ellipsis> kerberos-server </span> </a> </li> <li class=md-nav__item> <a href=../../roles/auth/openldap.md class=md-nav__link> <span class=md-ellipsis> openldap </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> 算法 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> 算法 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../%E7%AE%97%E6%B3%95/01.%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 0. 算法概述 </span> </a> </li> <li class=md-nav__item> <a href=../../redis/02.redis%E5%AE%A2%E6%88%B7%E7%AB%AF/ class=md-nav__link> <span class=md-ellipsis> 2. redis客户端 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11_3> <label class=md-nav__link for=__nav_11_3 id=__nav_11_3_label tabindex=0> <span class=md-ellipsis> 认证 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_11_3_label aria-expanded=false> <label class=md-nav__title for=__nav_11_3> <span class="md-nav__icon md-icon"></span> 认证 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roles/auth/kerberos-client.md class=md-nav__link> <span class=md-ellipsis> kerberos-client </span> </a> </li> <li class=md-nav__item> <a href=../../roles/auth/kerberos-server.md class=md-nav__link> <span class=md-ellipsis> kerberos-server </span> </a> </li> <li class=md-nav__item> <a href=../../roles/auth/openldap.md class=md-nav__link> <span class=md-ellipsis> openldap </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> Oracle </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Oracle </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../oracle/01.Oracle%E6%A6%82%E8%BF%B0/ class=md-nav__link> <span class=md-ellipsis> 1.Oracle概述 </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/02.oracle安装.md class=md-nav__link> <span class=md-ellipsis> 2.Oracle安装 </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/03.Oracle体系架构.md class=md-nav__link> <span class=md-ellipsis> 3.Oracle体系架构 </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/04.oracle访问控制.md class=md-nav__link> <span class=md-ellipsis> 4.Oracle访问控制 </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/05.常用SQL.md class=md-nav__link> <span class=md-ellipsis> 5.常用SQL </span> </a> </li> <li class=md-nav__item> <a href=../../oracle/06.%E8%BE%BE%E6%A2%A6%E4%BC%98%E5%8C%96/ class=md-nav__link> <span class=md-ellipsis> 6.达梦优化 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> 概述 </span> </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> <span class=md-ellipsis> 数据库设计 </span> </a> <nav class=md-nav aria-label=数据库设计> <ul class=md-nav__list> <li class=md-nav__item> <a href=#er class=md-nav__link> <span class=md-ellipsis> ER 图 </span> </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> <span class=md-ellipsis> 数据流图 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#uml class=md-nav__link> <span class=md-ellipsis> UML 图 </span> </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> <span class=md-ellipsis> 范式和反范式 </span> </a> <nav class=md-nav aria-label=范式和反范式> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> <span class=md-ellipsis> 范式 </span> </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> <span class=md-ellipsis> 多值属性 </span> </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> <span class=md-ellipsis> 树形结构 </span> </a> <nav class=md-nav aria-label=树形结构> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> <span class=md-ellipsis> 邻接表 </span> </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> <span class=md-ellipsis> 物化路径表 </span> </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> <span class=md-ellipsis> 闭包表 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> <span class=md-ellipsis> 主键 </span> </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> <span class=md-ellipsis> 外键 </span> </a> </li> <li class=md-nav__item> <a href=#eav class=md-nav__link> <span class=md-ellipsis> EAV 模型 </span> </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> <span class=md-ellipsis> 多列属性 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> <span class=md-ellipsis> 设计规约 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=_1>数据库设计<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <h2 id=_2>概述<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>数据库设计属于系统设计的范畴，通常把使用数据库的系统称为数据库应用系统，把对数据库应用系统的设计成为数据库设计。</p> <p>按照软件工程对系统生命周期的定义，软件生命周期分为 6 个阶段：</p> <ul> <li> <p>制定计划</p> </li> <li> <p>需求分析</p> </li> <li> <p>系统设计</p> </li> <li> <p>程序编制</p> </li> <li> <p>测试以及运行维护</p> </li> </ul> <p>在数据库设计中，也参照这种划分，划分数据库应用系统的生命周期：</p> <ul> <li> <p>数据库规划</p> </li> <li> <p>需求描述与分析</p> </li> <li> <p>数据库与应用程序设计</p> </li> <li> <p>数据库设计与实现</p> </li> <li> <p>测试</p> </li> <li> <p>运行维护</p> </li> </ul> <h2 id=_3>数据库设计<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p>数据库设计是对数据进行组织和结构化的过程，关键问题是数据模型的设计。一个良好的设计对于数据库系统至关重要，它可以减少系统中的数据冗余、确保数据的一致性和完整性，同时易于维护和扩展。</p> <p><strong>数据库设计是指对于一个给定的应用环境，构造（设计）优化的数据库逻辑模式和物理结构，并据此建立数据库及其应用系统，使之能够有效地存储和管理数据，满足各种用户的应用需求，包括信息管理要求和数据操作要求</strong>。</p> <p><strong>数据库设计的目标</strong> ：是为用户和各种应用系统提供一个信息基础设施和高效率的运行环境 。</p> <p><strong>数据库设计的基本任务</strong> ：是根据用户的信息需求、处理需求和数据库的支持环境(包括硬件、操作系统和 DBMS)，设计出数据库模式(包括外模式、逻辑模式和内模式)及其典型的应用程序。</p> <p>我们在设计数据表的时候，要考虑很多问题。比如：</p> <ul> <li> <p>用户都需要什么数据?需要在数据表中保存哪些数据？</p> </li> <li> <p>如何保证数据表中数据的正确性，当插入、删除、更新的时候该进行怎样的约束检查?</p> </li> <li> <p>如何降低数据表的数据冗余度 ，保证数据表不会因为用户量的增长而迅速扩张?</p> </li> <li> <p>如何让负责数据库维护的人员更方便地使用数据库?</p> </li> <li> <p>使用数据库的应用场景也各不相同，可以说针对不同的情况，设计出来的数据表可能 千差万别 。</p> </li> </ul> <p>现实情况中，面临的场景:</p> <p>当数据库运行了一段时间之后，我们才发现数据表设计的有问题。重新调整数据表的结构，就需要做数据迁移，还有可能影响程序的业务逻辑，以及网站正常的访问。</p> <p>如果是糟糕的数据库设计可能会造成以下问题:</p> <ul> <li> <p>数据冗余、信息重复，存储空间浪费</p> </li> <li> <p>数据更新、插入、删除的异常</p> </li> <li> <p>无法正确表示信息</p> </li> <li> <p>丢失有效信息</p> </li> <li> <p>程序性能差</p> </li> </ul> <p>良好的数据库设计则有以下优点:</p> <ul> <li> <p>节省数据的存储空间</p> </li> <li> <p>能够保证数据的完整性</p> </li> <li> <p>方便进行数据库应用系统的开发</p> </li> </ul> <p>总之，开始设置数据库的时候，我们就需要重视数据表的设计。为了建立 冗余较小、结构合理 的数据库，设计数据库时必须遵循一定的规则。</p> <ul> <li> <p>用户需求分析</p> </li> <li> <p>产出：需求说明文档，数据字典和数据流图</p> </li> <li> <p>概念结构设计</p> </li> <li> <p>逻辑结构设计</p> </li> <li> <p>物理结构设计</p> </li> <li> <p>数据库实施阶段</p> </li> <li> <p>数据库运行和维护阶段</p> </li> </ul> <h4 id=er>ER 图<a class=headerlink href=#er title="Permanent link">&para;</a></h4> <p>实体关系图（（Entity-Relationship Diagram））也被称为 ERD、ER 图、实体联系模型、实体联系模式图或 ER 模型，是一种用于数据库设计的结构图。它描述了数据库中的实体以及这些实体之间的关系。ERD 包括**实体**、**属性**以及**关系**三个部分。</p> <p>一幅 ERD 包含不同的符号和连接符，用于显示两个重要的信息： <strong>系统范围内的主要实体，以及这些实体之间的相互关系</strong></p> <p><mark><strong>E-R 图叫实体联系图，用图形化表示数据库的全局逻辑结构。</strong></mark></p> <ul> <li> <p>在 ER 模型中，实体显示为 <strong>圆角矩形</strong> ，其名称位于上方，其属性列在实体形状的主体中。实体代表了一种对象或者概念。例如，员工、部门和职位都可以称为实体。</p> </li> <li> <p><strong>分成两部分的矩形</strong> 代表实体集， <strong>阴影部分</strong> 是实体集名字，第二部分包括实体集属性，主码属性带下划线。属性表示实体的某种特性，例如员工拥有姓名、性别、工资、所在部门等属性。</p> </li> <li> <p><strong>菱形</strong> 代表联系集。</p> </li> <li> <p><strong>未分割的矩形</strong> 代表联系集的属性。</p> </li> <li> <p>联系集与其属性以 <strong>虚线</strong> 连接。</p> </li> <li> <p><strong>线段</strong> 将实体集与联系集连接。</p> </li> </ul> <p>详细可以参考<a href=https://www.visual-paradigm.com/cn/guide/data-modeling/what-is-entity-relationship-diagram/ >visual-paradigm</a></p> <p>进一步来说，ERD 可以按照抽象层次分为三种：</p> <ul> <li>概念 ERD，即概念数据模型。描述系统中存在的业务对象以及它们之间的联系，一般给业务分析人员使用。上图就是一个概念 ERD。</li> <li>逻辑 ERD，即逻辑数据模型。对概念数据模型进一步的分解和细化，转换为关系模型。同时，还需要引入规范化过程，对关系模式进行优化。</li> <li>物理 ERD，即物理数据模型。物理 ERD 是针对具体数据库的设计描述，需要为每列指定类型、长度、可否为空等属性，为表增加主键、外键以及索引等</li> </ul> <h4 id=_4>数据流图<a class=headerlink href=#_4 title="Permanent link">&para;</a></h4> <p>从原理上讲，只要纸足够大，一个软件系统的分析模型就可以画在一张纸上。然而，一个复杂的软件系统可能涉及上百个加工和上百个数据流，甚至更多。</p> <p>如果将它们画在一张图上，则会十分复杂，不易阅读，也不易理解。因此，根据自顶向下逐层分解的思想，可以将数据流图按照层次结构来绘制。</p> <p>DFD 中使用级别或层来表示有关系统或过程的渐进式详细程度。这些级别包括：</p> <p>级别 0：也称为"上下文图"，这是最高级别，它仅包含一个流程节点（"流程 0"），它概括了与外部实体相关的整个系统的功能。</p> <ul> <li>所有外部实体以及进出它们的主要数据流都显示在上下文图上。</li> <li>该图不包含任何数据存储。</li> <li>上下文图中的进程名称应该是信息系统的名称。例如，评分系统、订单处理系统、注册系统。</li> </ul> <p>级别 1：仍然是系统的相对宽泛的视图，但包含子流程和更多细节。</p> <p>级别 2：提供更多细节，并根据需要继续分解子流程。</p> <p>级别 3：虽然这种详细程度并不常见，但复杂系统可以从该级别的表示中受益。</p> <p><mark><strong>数据流图 (DFD) 用于表示业务信息系统中的数据流，它表达了系统中的据传从输入到存储间所涉及的程序。</strong></mark></p> <p>数据流图可以分为 <strong>逻辑形</strong> 和 <strong>物理形</strong> 。</p> <ul> <li> <p>逻辑数据流图描述了用以完成某业务功能所涉及的、业务层面的数据流动</p> </li> <li> <p>物理数据流图描述系统层面的数据流动。</p> </li> </ul> <p>数据流图中的各种规则：</p> <ul> <li> <p>程序： 程序表示对数据的处理过程，它可以接收输入，并产生输出，每个程序都有一个名称来标识它所执行的功能，比如：申请付款，计算佣金等。用 <strong>圆角矩形</strong> 表示。</p> </li> <li> <p>数据存储: 表示暂时存储的数据 , 数据存储的粒度是以表为单位。用 <strong>半框矩形</strong> 表示。</p> </li> <li> <p>数据存储必须以数据流连接到程序。</p> </li> <li> <p>每个数据存储必须至少有一个输入数据流和至少一个输出数据流（即使输出数据流是一个确认讯息）。</p> </li> <li> <p>方向：流向文件的数据流 表示 向文件内写入内容 , 从文件流出的数据流 表示 从文件读取内容 ;</p> </li> <li> <p>外部实体(实体)： 软件系统之外的人员/组织，实体用 <strong>直角矩形</strong> 表示。</p> </li> <li> <p>数据流： 数据流是数据从信息系统的一个部分移动到另一个部分的路径。</p> </li> <li> <p>带输入箭头的直线即为 <strong>输入数据流</strong></p> </li> <li> <p>带输入箭头的直线即为 <strong>输入数据流</strong></p> </li> <li> <p>由于每个程序都将数据从一种形态转换为另一种形态，故每个程序必须至少有一个输入数据流和一个输出数据流。</p> </li> <li> <p>数据流图的一大原则是数据不能自行转换成另一形态，数据必须经由某程序的处理才可被分发至系统的某个部份。通过这条规则，我们可以非常容易地识别出错误画法。</p> </li> </ul> <h2 id=uml>UML 图<a class=headerlink href=#uml title="Permanent link">&para;</a></h2> <p>UML 是 <code>Unified Model Language</code> 的缩写，中文是 <strong>统一建模语言</strong> ，是由一整套图表组成的标准化建模语言。</p> <p>在软件开发中，当系统规模比较复杂时，需要用图形抽象地来表达复杂的概念，让整个软件设计更具有可读性，可理解性，以便尽早发现软件设计时存在的潜在问题，从而降低开发风险。同时，也极大地方便了业务人员与开发人员之间的交流。</p> <p>UML 提供了极富表达能力的建模语言，可以让软件开发过程中的不同人员分别得到自己感兴趣的信息。</p> <p>Page-Jones 在《Fundamental Object-Oriented Design in UML》 一书中总结了 UML 的主要目的，如下：</p> <ul> <li>为用户提供现成的、有表现力的可视化建模语言，以便他们开发和交换有意义的模型。</li> <li>为核心概念提供可扩展性 (Extensibility) 和特殊化 (Specialization) 机制。</li> <li>独立于特定的编程语言和开发过程。</li> <li>为了解建模语言提供一个正式的基础。</li> <li>鼓励面向对象工具市场的发展。</li> <li>支持更高层次的开发概念，如协作，框架，模式和组件。</li> <li>整合最佳的工作方法 (Best Practices)。</li> </ul> <p>UML 图分为结构图和行为图：</p> <ul> <li> <p>结构图分为类图、轮廓图、组件图、组合结构图、对象图、部署图、包图。</p> </li> <li> <p>行为图又分活动图、用例图、状态机图和交互图。</p> </li> <li> <p>交互图又分为序列图、时序图、通讯图、交互概览图。</p> </li> </ul> <h2 id=_5>范式和反范式<a class=headerlink href=#_5 title="Permanent link">&para;</a></h2> <p>SQL 是一门声明式的编程语言，就像 Lisp、Haskell 或者 XSLT。SQL 使用集合（set）作为根本的数据结构，而面向对象的语言使用的是对象（object）。受过传统培训的软件开发人员被所谓的"阻抗失配"所阻碍，因此很多程序员转而使用现成的面向对象的库，以此来避免学习如何高效地使用 SQL</p> <h3 id=_6>范式<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>规范化（Normalization）是数据库设计的一系列原理和技术，主要用于减少表中数据的冗余，增加完整性和一致性。</p> <p>我们在设计关系型数据库模型的时候，需要对关系内部各个属性之间联系的合理化程度进行定义。</p> <p>这就有了不同等级的规范要求，这些规范要求被称为范式（NF）。你可以把范式理解为，一张数据表的设计结构需要满足的某种设计标准的级别。</p> <p>在关系型数据库中，关于数据表设计的基本原则、规则就称为范式。可以理解为，一张数据表的设计结构需要满足的某种设计标准的级别。要想设计一个结构合理的关系型数据库，必须满足一定的范式。</p> <p>范式的英文名称是 Normal Form，简称 NF。它是英国人 E.F.Codd 在上个世纪 70 年代提出关系数据库模型后总结出来的。范式是关系数据库理论的基础，也是我们在设计数据库结构过程中所要遵循的 规则和指导方法。</p> <p>目前关系型数据库一共有 6 种范式，按照范式级别，从低到高分别是：</p> <ul> <li> <p>1NF（第一范式）</p> </li> <li> <p>2NF（第二范式）</p> </li> <li> <p>3NF（第三范式）</p> </li> <li> <p>BCNF（巴斯 - 科德范式）</p> </li> <li> <p>4NF（第四范式）</p> </li> <li> <p>5NF（第五范式，又叫做完美范式）</p> </li> </ul> <p>数据库的范式设计越高阶，冗余度就越低，同时高阶的范式一定符合低阶范式的要求，比如满足 2NF 的一定满足 1NF，满足 3NF 的一定满足 2NF，依次类推。</p> <p>一般来说数据表的设计应尽量满足 3NF。但也不绝对，有时候为了提高某些查询性能，我们还需要破坏范式规则，也就是反规范化。</p> <p>1NF 指的是数据库表中的任何属性都是原子性的，不可再分。</p> <p>这很好理解，我们在设计某个字段的时候，对于字段 X 来说，就不能把字段 X 拆分成字段 X-1 和字段 X-2。事实上，任何的 DBMS 都会满足第一范式的要求，不会将字段进行拆分。</p> <p>反范式是一种试图解决问题的方法，但通常会同时引发别的问题。一般来说，数据仓库（Data Warehouse）和在线分析系统（OLAP）会较多使用到反规范化的技术，因为它们以复杂查询和报表分析为主。</p> <p><strong>逻辑数据库设计反模式</strong></p> <p>在你开始编码之前，需要决定数据库里存储什么信息以及最佳的数据组织方式和内在关联方式。这包含了如何设计数据库的表、字段和关系。</p> <p><strong>物理数据库设计反模式</strong></p> <p>在知道了需要存储哪些数据之后，使用你所知的 RDBMS 技术特性尽可能高效地实现数据管理。这包含了定义表和索引，以及选择数据类型。你也要使用 SQL 的 DDL 语句，比如<code>CREATE TABLE</code>语句。</p> <p><strong>查询反模式</strong></p> <p>你需要向数据库中添加然后获取数据。SQL 的查询是使用"数据操作语言"来完成，比如 SELECT 、 UPDATE 和 DELETE 语句。</p> <p><strong>应用程序开发反模式</strong></p> <p>SQL 应该会用在使用 C++、Java、Php、Python 或者 Ruby 等语言构建的应用程序中。在应用程序中使用 SQL 的方式有好有坏，该部分内容描述了一些常见错误。</p> <h3 id=_7>多值属性<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <p>将数据库中原来存储单一用户标识的字段改成使用逗号分隔的用户标识列表，似乎是一个很简单且合理的解决方案。</p> <p>程序员通常使用逗号分隔的列表来避免在多对多的关系中创建交叉表，我将这种设计方式定义为一种反模式，称为乱穿马路（Jaywalking），因为乱穿马路也是避免过十字路口的一种方式。</p> <p>设计一个单值表列是非常简单的：你可以选择一个 SQL 的内置数据类型，以该类型来存储这个表项的数据，比如整型、日期类型或者字符串。但是如何才能做到在一列中存储一系列相关数据的集合呢？</p> <p>很自然，使用 VARCHAR 类型字段，并用逗号分隔对应的数据。</p> <p><strong>选择合适的分隔符</strong></p> <p>如果存储一个字符串列表而不是数字列表，列表中的某些条目可能会包含分隔符。使用逗号作为分隔符可能会有问题。当然，你到时候可以再换一个字符，但你能确保这个新字符永远不会出现在条目中吗？</p> <p><strong>列表长度限制</strong></p> <p>你能在一个 VARCHAR(30) 的结构中存多少数据呢？这依赖于每个条目的长度。如果每个条目只有 2 个字符长，那你能存 10 个条目（包括逗号）。但如果每个条目的长度为 6，你就只能存 4 个了。</p> <p>你怎能确定 VARCHAR(30) 能够支持你未来所需的最长列表呢？多长才够长？</p> <p><strong>合理使用反模式</strong></p> <p>出于性能优化的考量，可能在数据库的结构中需要使用反规范化的设计。将列表存储为以逗号分隔的字符串就是反规范化的一个实例。</p> <p>应用程序可能会需要逗号分隔的这种存储格式的数据，也可能没必要获取列表中的单独项。</p> <p>同样，如果应用程序接收的源数据是有逗号分隔的格式，而你只需要存储和使用它们并且不对其做任何修改，完全没必要分开其中的值。</p> <h3 id=_8>树形结构<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>在程序开发中，我们常遇到用树型结构来表示某些数据间的关系，如企业的组织架构、商品的分类、操作栏目等，目前的关系型数据库都是以二维表的形式记录存储数据，而树型结构的数据如需存入二维表就必须进行 Schema 设计。</p> <p>存在递归关系的数据很常见，数据常会像树或者以层级方式组织。</p> <p>在树形结构中，实例被称为节点（node）。每个节点有多个子节点和一个父节点。最上层的节点叫根（root）节点，它没有父节点。最底层的没有子节点的节点叫叶（leaf）。而中间的节点简单地称为非叶（nonleaf）节点。</p> <p>在层级数据中，你可能需要查询与整个集合或其子集相关的特定对象，例如下述树形数据结构：</p> <ul> <li><strong>组织架构图</strong>。职员与经理的关系是典型的树形结构数据，出现在无数的 SQL 书籍与论题中。</li> </ul> <p>在组织架构图中，每个职员有一个经理，在树结构中表现为职员的父节点。同时，经理也是一个职员。</p> <ul> <li><strong>话题型讨论</strong>。正如引言中介绍的，树形结构也能用来表示回复评论的评论链。在这种树中，评论的子节点是它的回复。</li> </ul> <h4 id=_9>邻接表<a class=headerlink href=#_9 title="Permanent link">&para;</a></h4> <p>在很多书籍或文章中，最常见的简单解决方案是添加 parent_id 字段来确定树的父子关系。这样的设计叫做邻接表。</p> <div class=highlight><pre><span></span><code><span class=c1>-- 假设用树形结构来描述一个部门的组织架构</span>

<span class=c1>-- DDL  用id来标识一个人，用manager_id来表示向上一个人汇报</span>
<span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>db_test</span><span class=p>.</span><span class=n>employees_mgr</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=n>manager_id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
<span class=w>    </span><span class=k>INDEX</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>manager_id</span><span class=w> </span><span class=p>),</span>
<span class=w>    </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>manager_id</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>employees_mgr</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=p>)</span>
<span class=p>);</span>


<span class=c1>-- test data</span>
<span class=k>insert</span><span class=w> </span><span class=k>into</span><span class=w> </span><span class=n>db_test</span><span class=p>.</span><span class=n>employees_mgr</span><span class=w> </span><span class=k>values</span>
<span class=p>(</span><span class=mi>333</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;Yasmina&quot;</span><span class=p>,</span><span class=w> </span><span class=k>null</span><span class=p>),</span><span class=w> </span><span class=cm>/* Yasmina is the CEO (manager_id is null) */</span>
<span class=p>(</span><span class=mi>198</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;John&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>333</span><span class=p>),</span><span class=w>     </span><span class=cm>/* John has id 198 and reports to 333 (Yasmina) */</span>
<span class=p>(</span><span class=mi>692</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;Tarek&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>333</span><span class=p>),</span><span class=w>    </span><span class=cm>/* Tarek has id 692 and reports to 333 (Yasmina) */</span>
<span class=p>(</span><span class=mi>29</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;Pedro &quot;</span><span class=p>,</span><span class=w> </span><span class=mi>198</span><span class=p>),</span><span class=w>    </span><span class=cm>/* Pedro has id 29 and reports to 198 (John) */</span>
<span class=p>(</span><span class=mi>4610</span><span class=p>,</span><span class=w> </span><span class=ss>&quot;Sarah&quot;</span><span class=p>,</span><span class=w> </span><span class=mi>29</span><span class=p>);</span><span class=w>    </span><span class=cm>/* Sarah has id 4610 and reports to 29 (Pedro) */</span>



<span class=c1>-- 查询一个节点的所有后代或所有父节点。</span>
<span class=c1>-- 要查询出如下这种树形效果：查出每个人的汇报对象</span>

<span class=o>+</span><span class=c1>------+---------+--------------------+</span>
<span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>path</span><span class=w>               </span><span class=o>|</span>
<span class=o>+</span><span class=c1>------+---------+--------------------+</span>
<span class=o>|</span><span class=w>  </span><span class=mi>333</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Yasmina</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>333</span><span class=w>                </span><span class=o>|</span>
<span class=o>|</span><span class=w>  </span><span class=mi>198</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>John</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>333</span><span class=o>-&gt;</span><span class=mi>198</span><span class=w>           </span><span class=o>|</span>
<span class=o>|</span><span class=w>  </span><span class=mi>692</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Tarek</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=mi>333</span><span class=o>-&gt;</span><span class=mi>692</span><span class=w>           </span><span class=o>|</span>
<span class=o>|</span><span class=w>   </span><span class=mi>29</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Pedro</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=mi>333</span><span class=o>-&gt;</span><span class=mi>198</span><span class=o>-&gt;</span><span class=mi>29</span><span class=w>       </span><span class=o>|</span>
<span class=o>|</span><span class=w> </span><span class=mi>4610</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Sarah</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=mi>333</span><span class=o>-&gt;</span><span class=mi>198</span><span class=o>-&gt;</span><span class=mi>29</span><span class=o>-&gt;</span><span class=mi>4610</span><span class=w> </span><span class=o>|</span>
<span class=o>+</span><span class=c1>------+---------+--------------------+</span>
<span class=mi>5</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span>
<span class=n>mysql</span><span class=o>&gt;</span>


<span class=c1>-- MySQL8.0中支持with子句</span>
<span class=c1>-- 通过recursive递归CTE来查询用户的层级关系</span>
<span class=c1>-- 规划一个ID，name，path这样的一个层级临时表</span>

<span class=k>with</span><span class=w> </span><span class=k>recursive</span><span class=w> </span><span class=n>employee_paths</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>path</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span>
<span class=w>     </span><span class=c1>-- 先查最顶层节点</span>
<span class=w>     </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=k>cast</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nb>char</span><span class=p>(</span><span class=mi>200</span><span class=p>))</span>
<span class=w>     </span><span class=k>from</span><span class=w> </span><span class=n>db_test</span><span class=p>.</span><span class=n>employees_mgr</span>
<span class=w>     </span><span class=k>where</span><span class=w> </span><span class=n>manager_id</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=k>null</span>
<span class=w>     </span><span class=k>union</span><span class=w> </span><span class=k>all</span>
<span class=w>     </span><span class=c1>-- 递归查询</span>
<span class=w>     </span><span class=k>select</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>concat</span><span class=p>(</span><span class=n>ep</span><span class=p>.</span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-&gt;&#39;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>id</span><span class=p>)</span>
<span class=w>     </span><span class=k>from</span><span class=w> </span><span class=n>employee_paths</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>ep</span>
<span class=w>     </span><span class=k>join</span><span class=w> </span><span class=n>db_test</span><span class=p>.</span><span class=n>employees_mgr</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>e</span>
<span class=w>     </span><span class=k>on</span><span class=w> </span><span class=n>ep</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>manager_id</span>
<span class=w>    </span><span class=p>)</span>
<span class=w>     </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>employee_paths</span><span class=p>;</span>
</code></pre></div> <p>这种方案的优点很明显：结构简单易懂，由于互相之间的关系只由一个 parent_id 维护，所以增删改都是非常容易，只需要改动和他直接相关的记录就可以。</p> <p>缺点当然也是非常的突出：由于直接地记录了节点之间的继承关系，因此对 Tree 的任何 CRUD 操作都将是低效的，这主要归根于频繁的“递归”操作，递归过程不断地访问数据库，每次数据库 IO 都会有时间开销。举个例子，如果想要返回所有节点，也就是某个人的所有子孙节点，看似很简单的操作，就需要用到一堆递归。</p> <p>合理地使用反范式，当然，这种方案并非没有用武之地，在树的层级比较少的时候就非常实用。这种方法的优点是存储的信息少，查直接上司和直接下属的时候很方便，缺点是多级查询的时候很费劲。所以当只需要用到直接上下级关系的时候，用这种方法还是不错的，可以节省很多空间。</p> <h4 id=_10>物化路径表<a class=headerlink href=#_10 title="Permanent link">&para;</a></h4> <p>邻接表的缺点之一是从树中获取一个给定节点的所有祖先的开销很大。路径枚举的设计通过将所有祖先的信息联合成一个字符串，并保存为每个节点的一个属性，很巧妙地解决了这个问题。</p> <p>路径枚举是一个由连续的直接层级关系组成的完整路径。如 /usr/local/lib 的 UNIX 路径是文件系统的一个路径枚举，其中 usr 是 local 的父亲，这也就意味着 usr 是 lib 的祖先。</p> <p>在 Comments 表中，我们使用类型为 VARCHAR 的 path 字段来代替原来的 parent_id 字段。 这个 path 字段所存储的内容为当前节点的最顶层的祖先到它自己的序列，就像 UNIX 的路径一样，你甚至可以使用'/'作为路径中的分割符。</p> <p>物化路径其实更加容易理解，其实就是在创建节点时，将节点的完整路径进行记录。</p> <div class=highlight><pre><span></span><code><span class=c1>-- 查询某一节点下的所有子节点:（以Fruit为例）</span>
<span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pathTree</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>node_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Fruit&#39;</span><span class=p>);</span>
<span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pathTree</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=n>CONCAT</span><span class=p>(</span><span class=o>@</span><span class=n>path</span><span class=p>,</span><span class=s1>&#39;/%&#39;</span><span class=p>);</span>

<span class=c1>-- 如何查询直属子节点？需要采用MySQL的正则表达式查询：</span>
<span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pathTree</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>node_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Fruit&#39;</span><span class=p>);</span>
<span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pathTree</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=n>REGEXP</span><span class=w> </span><span class=n>CONCAT</span><span class=p>(</span><span class=o>@</span><span class=n>path</span><span class=p>,</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=s1>&#39;[0-9]$&#39;</span><span class=p>);</span>

<span class=c1>-- 查询任意节点的所有上级：（以Yellow为例）：</span>
<span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pathTree</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>node_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Yellow&#39;</span><span class=p>);</span>
<span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pathTree</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=o>@</span><span class=n>path</span><span class=w> </span><span class=k>LIKE</span><span class=w> </span><span class=n>CONCAT</span><span class=p>(</span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;%&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=o>&lt;&gt;</span><span class=w> </span><span class=o>@</span><span class=n>path</span><span class=p>;</span>

<span class=c1>-- 插入新增数据：</span>
<span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=n>parent_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>pathTree</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>node_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Fruit&#39;</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>pathtree</span><span class=w> </span><span class=p>(</span><span class=n>path</span><span class=p>,</span><span class=n>node_name</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>CONCAT</span><span class=p>(</span><span class=o>@</span><span class=n>parent_path</span><span class=p>,</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=n>LAST_INSERT_ID</span><span class=p>()</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span><span class=s1>&#39;White&#39;</span><span class=p>)</span>
</code></pre></div> <p>此方案的缺点是树的层级太深有可能会超过 PATH 字段的长度，所以其能支持的最大深度并非无限的。</p> <p>如果层级数量是确定的，可以再将所有的列都展开，比较适用于于类似行政区划、生物分类法（界、门、纲、目、科、属、种）这些层级确定的内容。</p> <h4 id=_11>闭包表<a class=headerlink href=#_11 title="Permanent link">&para;</a></h4> <p>比如，地理区域、位置信息存储，地理信息按照层级划分，会分为很多层级，就拿中国的行政区域划分为例，简单的省-市-县-镇-村就要五个级别。</p> <p>如果系统涉及到跨境的国际贸易，那么存储的地理信息层级会更加深。</p> <p>闭包表由<code>Closure Table</code>翻译而来，通过父节点、子节点、两节点距离来描述一棵树空间换时间的思想。</p> <p><code>Closure Table</code>，一种更为彻底的全路径结构，分别记录路径上相关结点的全展开形式。能明晰任意两结点关系而无须多余查询，级联删除和结点移动也很方便。但是它的存储开销会大一些，除了表示结点的 Meta 信息，还需要一张专用的关系表。</p> <p>闭包表，它记录了树中所有节点的关系，不仅仅只是直接父子关系，它需要使用两张表，除了节点表本身之外，还需要使用一张关系表，用来存储祖先节点和后代节点之间的关系（同时增加一行节点指向自身）,并且根据需要，可以增加一个字段，表示深度。</p> <div class=highlight><pre><span></span><code><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>village</span><span class=o>`</span><span class=w> </span><span class=p>(</span>
<span class=w>    </span><span class=o>`</span><span class=n>code</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
<span class=w>    </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>),</span>
<span class=w>    </span><span class=o>`</span><span class=n>streetCode</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=o>`</span><span class=n>street</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>code</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
<span class=w>    </span><span class=o>`</span><span class=n>provinceCode</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=o>`</span><span class=n>province</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>code</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
<span class=w>    </span><span class=o>`</span><span class=n>cityCode</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=o>`</span><span class=n>city</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>code</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span><span class=p>,</span>
<span class=w>    </span><span class=o>`</span><span class=n>areaCode</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=o>`</span><span class=n>area</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>code</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>CASCADE</span>

<span class=p>);</span>

<span class=c1>-- 部门信息表</span>
<span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=w> </span><span class=p>(</span>
<span class=w>  </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;ID&#39;</span><span class=p>,</span>
<span class=w>  </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w> </span><span class=nb>CHARACTER</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>utf8mb4</span><span class=w> </span><span class=k>COLLATE</span><span class=w> </span><span class=n>utf8mb4_general_ci</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;部门名称&#39;</span><span class=p>,</span>
<span class=w>  </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;父ID&#39;</span><span class=p>,</span>
<span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span>
<span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8mb4</span><span class=w> </span><span class=k>COLLATE</span><span class=o>=</span><span class=n>utf8mb4_general_ci</span><span class=w> </span><span class=k>COMMENT</span><span class=o>=</span><span class=s1>&#39;部门表&#39;</span><span class=p>;</span>

<span class=c1>-- 部门信息闭包表</span>
<span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=o>`</span><span class=n>departments_closure_table</span><span class=o>`</span><span class=w> </span><span class=p>(</span>
<span class=w>  </span><span class=o>`</span><span class=n>ancestor</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;祖先节点&#39;</span><span class=p>,</span>
<span class=w>  </span><span class=o>`</span><span class=n>descendant</span><span class=o>`</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>COMMENT</span><span class=w> </span><span class=s1>&#39;后代节点&#39;</span><span class=p>,</span>
<span class=w>  </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>ancestor</span><span class=o>`</span><span class=p>,</span><span class=o>`</span><span class=n>descendant</span><span class=o>`</span><span class=p>),</span>
<span class=w>  </span><span class=k>KEY</span><span class=w> </span><span class=o>`</span><span class=n>fk_descendant</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>descendant</span><span class=o>`</span><span class=p>),</span>
<span class=w>  </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=o>`</span><span class=n>fk_ancestor</span><span class=o>`</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>ancestor</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>RESTRICT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>RESTRICT</span><span class=p>,</span>
<span class=w>  </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=o>`</span><span class=n>fk_descendant</span><span class=o>`</span><span class=w> </span><span class=k>FOREIGN</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>descendant</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=w> </span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>DELETE</span><span class=w> </span><span class=k>RESTRICT</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>RESTRICT</span>
<span class=p>)</span><span class=w> </span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8mb4</span><span class=w> </span><span class=k>COLLATE</span><span class=o>=</span><span class=n>utf8mb4_general_ci</span><span class=w> </span><span class=k>COMMENT</span><span class=o>=</span><span class=s1>&#39;部门信息闭包表&#39;</span><span class=p>;</span>


<span class=c1>-- 填充部门表</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;集团总部&#39;</span><span class=p>,</span><span class=w> </span><span class=k>NULL</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;华北总部&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;华南总部&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;华东总部&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;华中总部&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;华西总部&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>7</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;北京子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;天津子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>9</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;河北子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;广东子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>11</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;广西子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>12</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;海南子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>13</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;四川子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>14</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;重庆子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>15</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;贵州子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>16</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;云南子公司&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>6</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>17</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;成都办事处&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>13</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>18</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;广元办事处&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>13</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>19</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;雅安办事处&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>13</span><span class=p>);</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>`</span><span class=n>hytto_cs</span><span class=o>`</span><span class=p>.</span><span class=o>`</span><span class=n>departments</span><span class=o>`</span><span class=p>(</span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>name</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=o>`</span><span class=n>parent_id</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>20</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;绵阳办事处&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>13</span><span class=p>);</span>


<span class=c1>-- 填充闭包信息表</span>
<span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>departments_closure_table</span><span class=w> </span><span class=p>(</span><span class=n>ancestor</span><span class=p>,</span><span class=w> </span><span class=n>descendant</span><span class=p>,</span><span class=w> </span><span class=n>depth</span><span class=p>)</span>
<span class=k>WITH</span><span class=w> </span><span class=k>RECURSIVE</span><span class=w> </span><span class=n>cte</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
<span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>ancestor</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>descendant</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>depth</span>
<span class=w>  </span><span class=k>FROM</span><span class=w> </span><span class=n>departments</span>
<span class=w>  </span><span class=k>UNION</span><span class=w> </span><span class=k>ALL</span>
<span class=w>  </span><span class=k>SELECT</span><span class=w> </span><span class=n>cte</span><span class=p>.</span><span class=n>ancestor</span><span class=p>,</span><span class=w> </span><span class=n>departments</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>cte</span><span class=p>.</span><span class=n>depth</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span>
<span class=w>  </span><span class=k>FROM</span><span class=w> </span><span class=n>cte</span>
<span class=w>  </span><span class=k>JOIN</span><span class=w> </span><span class=n>departments</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>cte</span><span class=p>.</span><span class=n>descendant</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>departments</span><span class=p>.</span><span class=n>parent_id</span>
<span class=p>)</span>
<span class=k>SELECT</span><span class=w> </span><span class=n>ancestor</span><span class=p>,</span><span class=w> </span><span class=n>descendant</span><span class=p>,</span><span class=w> </span><span class=n>depth</span>
<span class=k>FROM</span><span class=w> </span><span class=n>cte</span>
<span class=k>WHERE</span><span class=w> </span><span class=n>ancestor</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>descendant</span><span class=p>;</span>




<span class=c1>-- 按照部门ID升序进行分页查询，每页显示5个部门</span>
<span class=k>SELECT</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=o>*</span>
<span class=k>FROM</span><span class=w> </span><span class=n>departments</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>d</span>
<span class=k>JOIN</span><span class=w> </span><span class=n>departments_closure_table</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>ct</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ct</span><span class=p>.</span><span class=n>descendant</span>
<span class=k>WHERE</span><span class=w> </span><span class=n>ct</span><span class=p>.</span><span class=n>ancestor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=c1>-- 根部门的ID</span>
<span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>id</span>
<span class=k>LIMIT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>
</code></pre></div> <h3 id=_12>主键<a class=headerlink href=#_12 title="Permanent link">&para;</a></h3> <p>每个了解数据库设计的人都知道，主键对于一张表来说是一个很重要，甚至必需的部分。这确实是事实，主键是好的数据库设计的一部分。主键是数据库确保数据行在整张表中唯一性的保障，它是定位到一条记录并且确保不会重复存储的逻辑机制。主键也同时可以被外键引用来建立表与表之间的关系。</p> <p>难点是选择哪一列作为主键。大多数表中的每个属性的值都有可能被很多行使用。例如一个人的姓和名就一定会在表中重复出现，即使电子邮件地址或者美国社保编号或者税单编号也不能保证绝对不会重复。</p> <p>在这样的表中，需要引入一个对于表的域模型无意义的新列来存储一个伪值。这一列被用作这张表的主键，从而通过它来确定表中的一条记录，即便其他的列允许出现适当的重复项。这种类型的主键列我们通常称其为<code>伪主键</code>或者<code>代理键</code>。</p> <p>大多数的数据库提供一种和当前处理事务无关的底层方案，来确保每次都能生成全局唯一的一个整数作为伪主键，即使客户端此时正发起并发操作。</p> <blockquote> <p>一张没有主键的表就好像你的 MP3 播放列表里没有歌名一样。你依然可以听歌，但无法找到想听的那首歌，也没办法确保播放列表中没有重复的歌曲。</p> </blockquote> <p>伪主键直到 SQL:2003 才成为一个标准，因而每个数据库都使用自己特有的 SQL 扩展来实现伪主键，甚至不同数据库中对于伪主键都有不同的名称（不同的表述）</p> <table> <thead> <tr> <th>名称</th> <th>数据库</th> </tr> </thead> <tbody> <tr> <td>AUTO_INCREMENT</td> <td>MySQL</td> </tr> <tr> <td>GENERATOR</td> <td>Firebird, InterBase</td> </tr> <tr> <td>IDENTITY DB2</td> <td>Derby, Microsoft SQL Server, Sybase</td> </tr> <tr> <td>ROWID</td> <td>SQLite</td> </tr> <tr> <td>SEQUENCE DB2</td> <td>Firebird, Informix, Ingres, Oracle, PostgreSQL</td> </tr> <tr> <td>SERIAL</td> <td>MySQL, PostgreSQL</td> </tr> </tbody> </table> <p>虽然各家数据库产品的伪主键叫法不同，但是给伪主键指派的列名，确是出奇的一致，那就是 id。</p> <h3 id=_13>外键<a class=headerlink href=#_13 title="Permanent link">&para;</a></h3> <p>关系数据库的设计基本上可以说就是关于每张独立表之间的关系的设计。引用完整性是合理的数据库设计和操作的非常重要的一部分。</p> <p>当一列或者多列声明了外键约束后，这些列中的数据必须在其父表（即所引用的表）的主键列或者唯一字段的列中存在。</p> <p><code>物理外键</code>是我们学习数据库原理和设计时都会遇到的章节，它的主要优势是可以通过数据库实现强制的 Referential Integrity，即引用完整性。但这样的完整性使用逻辑外键也完全能实现，有人认为逻辑外键由于完全依赖业务代码所以无法真正保证完整性，但这其实是个伪命题，因为物理外键也是由「人」来设置的，你只能保证设置过的物理外键能保证引用完整性，至于那些没考虑到的、设计错误的数据关联关系仍然是物理外键无法解决的，在这一点上物理外键和逻辑外键是没有实质区别的。而实际上当今的云原生架构在数据层面追求的是分布式和最终一致性，单个 DB 存储所有数据的时代早已过去，数据在服已务间流转经是常态，此外国内场景下很多数据也不被允许直接物理删除，物理外键的作用在现代架构下变得微乎其微。物理外键不是银弹，它甚至都没有成为银弹的实力。</p> <p>说到劣势，物理外键在现代后端架构中的缺点已经越发明显。分场景分析如下：</p> <ul> <li> <p>对于传统企业应用，交付后几乎没有大面积迭代，使用物理外键是无可厚非的，这也是对传统软件开发模式和架构的传承。但现在有越来越多的企业选择使用 SaaS 或自主进行研发和维护，这也就意味着产品的迭代会比此前频繁得多，进而变为下文提到的流量小但迭代频繁的项目。</p> </li> <li> <p>玩具型项目用不用外键都没有区别。</p> </li> <li> <p>大流量项目使用物理外键无疑是在埋坑，抛开颇受争议的性能问题不谈，物理外键无法满足分库分表、单元化等现代架构设计的需要，甚至在这些架构下还会成为累赘要额外花费时间改造掉。</p> </li> <li> <p>小流量项目的迭代速度可不慢，领域模型很难稳定下来，而使用了物理外键也就意味着系统是基于数据库进行的建模，那么当前的物理外键设计迟早有一天要面临变更，这所带来的维护成本（改表困难、业务拆分和聚合困难等）是巨大的，这也是为什么现在很少有人使用存储过程的原因。</p> </li> </ul> <p>在人员职责上，DBA 与业务强耦合本身就是不合理的，这和为什么要做前后端分离是一个道理，这也是为什么当今很多互联网公司会选择一名 DBA 对接一个后端大组甚至事业部的原因，DBA 的职责已经下沉到更核心的数据库稳定性和性能提升上。而在架构中的分层职责上，在持久层耦合业务逻辑是非常不明智的，因为这意味着你的架构会严重依赖某个数据库选型甚至某个特定版本数据库的功能，领域模型与数据模型的耦合也会产生很多人噩梦中的一个 Service 层走天下的情况，业务逻辑很难做进一步的抽象和拆分，至于读写模型分离、CQRS 也就是更不可能的事情了。</p> <p>在架构中的分层职责上，在持久层耦合业务逻辑是非常不明智的，因为这意味着你的架构会严重依赖某个数据库选型甚至某个特定版本数据库的功能，领域模型与数据模型的耦合也会产生很多人噩梦中的一个 Service 层走天下的情况，业务逻辑很难做进一步的抽象和拆分，至于读写模型分离、CQRS 也就是更不可能的事情了。</p> <p>使用物理外键能带来收益非常有限，但隐性成本（只要业务还在发展，那未来早晚会变为显性成本）却非常高，其本身又可以被逻辑外键所替代</p> <h3 id=eav>EAV 模型<a class=headerlink href=#eav title="Permanent link">&para;</a></h3> <p>假设要做一个电商的商品管理，有一张商品表。我们先卖一些衣服，需要管理衣服的尺码、颜色、款式等信息，有一天需要卖电脑了，电脑需要 主板、CPU、显卡、内存、硬盘、散热 等信息，过几天又需要卖手机了，手机有 颜色、版本、存储容量、套餐类型等等信息，数据库如何设计？</p> <p>方案一：新增字段 每次新增商品，需要支持不同的信息的话就不停的加字段。</p> <p>ID Name 尺码 颜色 款式 主板 CPU 显卡 内存 存储 散热 版本 套餐类型 1 T 恤 M 白色 喜羊羊 NULL NULL NULL NULL NULL NULL NULL NULL 2 外星人电脑 NULL NULL NULL A i99 RTX8090 32G 2T 水冷 NULL 键鼠套装 3 香蕉手机 NULL 五彩斑斓黑 NULL NULL 晓龙 999 NULL 12G 512G 风扇 Pro Plus MAX 碎屏险套餐</p> <p>这样会造成以下问题：</p> <ul> <li>实现成本高，每次添加商品都需要进行前后端开发、调试，浪费时间和人力。</li> <li>需要动态变更表结构，在生产环境中安全性太低。</li> <li>浪费资源，数据库的字段可能会越来越多，而很多字段大部分商品都是不需要的，需要设置为 NULL，导致内存大量浪费。</li> <li>扩展能力一般，有上限。</li> </ul> <p>Entity-Attribute-Value (wiki)是一种数据模型，用于以节省空间的方式对实体进行编码。</p> <ul> <li>Entity：实体，代表一个业务对象，比如上面的例子里的商品。</li> <li>Attribute：对象的属性，属性并不是作为实体单独的一列来进行存放，而是存储在一组单独的数据库表中。</li> <li>Value：指特定属性所关联的值。</li> </ul> <p>在现代面向对象的编程模型中，不同的对象类型可能是相连的。比如，多个对象都可能是从同一个基类派生而来，它们既是实际子类的实例，也同时是父类的实例。我们可能想仅使用一张表来存储所有这些不同类型的对象，这样能方便进行比较和计算。但我们也需要将不同的子类分开存储，因为每个子类都有一些特殊的属性，和其他的子类甚至父类都不能共用。</p> <h3 id=_14>多列属性<a class=headerlink href=#_14 title="Permanent link">&para;</a></h3> <h2 id=_15>设计规约<a class=headerlink href=#_15 title="Permanent link">&para;</a></h2> <p>数据库设计和建模是一些很少得到应有关注的主题，尤其是在项目开始时，但是一旦事情失去控制，问题会变得非常棘手。</p> <p>在设计数据库技术方案时，我们是有自己的设计理念或者原则，还是更多依据直觉去设计？是否曾经懊悔线上发生过的一次低级故障？是否思考过怎样才能避免？设计规范的价值在于提供了一份工作检查清单，我们不断从错误中积累有效经验，指导未来的工作。</p> <p>是否使用预留字段？</p> <p>在项目交付前，需求不断在变，如何在需求改变的同时尽可能减少对表结构的修改是我们现在考虑的问题。对于一般情况而言，在设计的时候我们可以适当添加一些预留的字段，需求改变的时候可以用上，或者说是添加不足的字段。</p> <p>在数据表中，不仅设计了当前所需要的字段，而且还在其中留出几个字段作为备用。比方说，设计了一个人员表（Person），其中已经添加了各种必要的字段，包括姓名（Name）、性别（Sex）、出生年月日（birthday）等等。大功告成之后，忽然想到，将来系统中应该还会有很多其它与人相关的内容吧，比方说毕业院校，比方说工作单位等等，尽管现在根本不需要填写，以后可能还是会用到的吧。拍脑袋一项，那就加入 5 个 varchar2 型的字段，分别叫做 Text1、Text2……Text5，然后又想，应该还有一些日期型的字段需要备用，就又建立了三个 date 型的字段，分别起名叫做 date1、date2、date3。</p> <p>【解决方案】</p> <p>其实上面的这种设计方式就是一种“过度设计”，我们应该做的就是“按需设计”。因此要禁止在表中建立预留字段，理由如下：</p> <p>1.无法准确的知道预留字段的类型，所以无法选择合适的类型。</p> <p>2.无法准确的知道预留字段中所存储的内容，预留字段的命名很难做到见名识义</p> <p>3.后期维护预留字段所要的成本，同增加一个字段所需要的成本是相同的。对预留字段类型的修改，会对表进行锁定。（修改一个字段的成本，大于新增字段）。</p> <p>推荐解决办法是，当需要增加相关的信息的时候：</p> <p>如果数量很少，而且信息的性质与原表密切相关，那么就可以直接在原表上增加字段，并将相关的数据更新进去； 如果数量较大，或者并非是原表对象至关重要的属性，那么就可以新增一个表，然后通过键值连接起来； 对于表的数据的存储位置所导致的性能问题，我们可以通过在特定时间对数据库的数据进行重组来解决，而这项工作对于长期运行的数据库来说，也是需要定期进行的。</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title=最后更新> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="2025年10月22日 07:21:56 UTC">2025-10-22 07:21:56</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyleft &copy; 2020 - 2023 fengzhao </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../assets/javascripts/bundle.1e8ae164.min.js></script> </body> </html>